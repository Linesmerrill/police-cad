<!DOCTYPE html>
<html>

<head>
  <% include ad-header %>
  <title>LPC - Dispatch Dashboard</title>
  <meta charset="utf-8">
  <meta name="description"
    content="Lines Roleplay Police CAD. Built to facilitate the needs of roleplay police and civilians." />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Codeply">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="stylesheet" href="/static/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
  <link rel="stylesheet" href="/static/css/animate.min.css" />
  <link rel="stylesheet" href="/static/css/ionicons.min.css" />
  <link rel="stylesheet" href="/static/css/tail.select-dark.min.css" />
  <link rel="stylesheet" href="/static/css/awesomplete.css" />
  <link rel="stylesheet" href="static/css/style.css">
  <link rel="stylesheet" href="/static/css/styles.css" />
  <script type="module" src="https://unpkg.com/ionicons@5.1.2/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule="" src="https://unpkg.com/ionicons@5.1.2/dist/ionicons/ionicons.js"></script>
  <link rel="shortcut icon" type="image/ico" href="static/images/favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Signika:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://code.iconify.design/1/1.0.3/iconify.min.js"></script>
  <script type="text/javascript" src="static/js/tail.select.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
  <script src="/static/js/jquery.min.js"></script>
  <script src="/static/js/jquery.easing.min.js"></script>
  <script src="/static/js/wow.js"></script>
  <script src="/static/js/popper.js"></script>
  <script src="/static/js/main.js"></script>
  <script src="/static/js/dispatch-dashboard.js"></script>
  <script src="/static/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap4.min.css">
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap4.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.0/jquery.cookie.min.js"></script>
  <script type="text/javascript" src="static/js/tail.select.min.js"></script>
  <!-- To hide google translate header bar on each page -->
  <style type='text/css'> iframe.goog-te-banner-frame{ display: none !important;}</style>
  <style type='text/css'> body {position: static !important; top:0px !important;}</style>
  <style>
    #titleCallDetail {
      background-color: transparent !important;
      color: white !important;
      
    }
    #detailsCallDetail {
      background-color: transparent !important;
      color: #fff !important;
    }
    #statusCallDetail {
      padding: 0.5em 1em;
    }
    .select2 {
    color: black;
  }
  .select2-results__group {
    color: blue;
  }
  .select2-results__options {
    color: black;
  }
  .badge-secondary {
    padding: 0.5em 1em;
  }
  .select2-search__field {
    width: 100%
  }
  .select2-container {
    width: 100% !important; /* Ensure container is full width */
  }
  .select2-selection__placeholder {
    width: 100% !important; /* Ensure placeholder text is full width */
    white-space: nowrap; /* Prevent text wrapping */
    overflow: hidden; /* Hide overflow */
    text-overflow: ellipsis; /* Add ellipsis if too long */
  }
  .select2-selection--multiple {
    width: 100% !important; /* Ensure multi-select is full width */
  }
  .status-select {
    background-color: transparent;
  }
  </style>
</head>

<body>

  <div class="wrapper d-flex align-items-stretch">

    <nav id="sidebar" style="z-index: 9;">
      <div class="img bg-wrap text-center py-4" style="background-image: url(/static/images/dispatch-corner-bg2.jpg);">
        <div class="user-logo">
          <a data-toggle="modal" href="#accountModal" onclick="fillAccountDetails()">
            <div class="img profile-picture"></div>
          </a>
          <h3>
            <%=user.user.username%>
          </h3>
          <h5>
            <%=user.user.callSign%>
          </h5>
          <h5>Logged in as: Dispatch</h5>
        </div>
      </div>
      <ul class="list-unstyled components mb-5">
        <li>
          <a href="/"><span class="fa fa-home mr-3"></span> <img style="display: inline; margin-top: -9px; vertical-align: text-top;" src="/static/images/favicon-32x32.png"></img> Lines Police CAD</a>
        </li>
        <li class="background-color-222">
          <a type="button" data-toggle="collapse" data-target="#toggleSearch" aria-expanded="true"
            aria-controls="toggleSearch" onclick="toggleCaret()"> Search <i class="fa fa-caret-right pull-right rotate"
              style="margin-top: 0.3em;"></i></a>
        </li>
        <div class="collapse in" id="toggleSearch">
          <input type="hidden" id="searchType" value="Civilian">
  <li>
    <a data-toggle="modal" onclick="showSearchDatabaseModal('Civilian')" data-search-type="Civilian"><span
        class="fa fa-id-card ml-3 mr-3"></span> Name Database</a>
  </li>
  <li>
    <a data-toggle="modal" onclick="showSearchDatabaseModal('Vehicle')" data-search-type="Vehicle"><span
        class="fa fa-car ml-3 mr-3"></span> Plate Database</a>
  </li>
  <li>
    <a data-toggle="modal" onclick="showSearchDatabaseModal('Firearm')" data-search-type="Firearm"><span
        class="fa fa-database ml-3 mr-3"></span> Firearm Database</a>
  </li>
</div>
        <li class="background-color-222">
          <a type="button" data-toggle="collapse" data-target="#toggleUtilities" aria-expanded="false"
            aria-controls="toggleUtilities" onclick="toggleCaret()"> Utilities <i
              class="fa fa-caret-right pull-right rotate" style="margin-top: 0.3em;"></i></a>
        </li>
        <div class="collapse in" id="toggleUtilities">
          <li>
            <% if (user.user.activeCommunity !='' && user.user.activeCommunity !=null) {%>
  <a href="javascript:void(0)" onclick="showBoloModal()"><span
      class="fa fa-exclamation-triangle ml-3 mr-3"></span>Create BOLO</a>
<% } else {%>
  <a data-toggle="modal" href="#nonCommunityBoloModal" class="mock-disabled"><span
      class="fa fa-exclamation-triangle ml-3 mr-3"></span>Create BOLO</a>
<% } %>
          </li>
          <li>
            <% if (user.user.activeCommunity !='' && user.user.activeCommunity !=null) {%>
              <a data-toggle="modal" href="#callModal" onclick=""><span
                  class="fa fa-plus-square ml-3 mr-3"></span> Create Call</a>
              <% } else {%>
                <a data-toggle="modal" href="#nonCommunityBoloModal" class="mock-disabled"><span
                    class="fa fa-plus-square ml-3 mr-3"></span> Create Call</a>
                <% } %>
          </li>
          <!-- <li>
            <a data-toggle="modal" href="#10codesModal"><span class="fa fa-list-alt ml-3 mr-3"></span> 10-Codes</a>
          </li> -->
          <li>
            <a href="/penal-code"><span class="fa fa-laptop ml-3 mr-3"></span>Penal Codes <i
                class="fa fa-external-link-alt"></i></a>
          </li>
          <!-- <li>
            <a data-toggle="modal" href="#notepadModal"><span class="fa fa-clipboard ml-3 mr-3"></span> Notepad</a>
          </li> -->
          <li>
            <a href="/map-interactive"><span class="fa fa-map ml-3 mr-3"></span> Map <i
                class="fa fa-external-link-alt"></i></a>
          </li>
        </div>
        <% include departments-sidebar %>
        <% include community-sidebar %>
        <% include other-sidebar %>
      </ul>

    </nav>

    <!-- Page Content  -->
    <div id="content" class="">

      <nav id="topNav" class="topNav" style="z-index: 8; margin-bottom: 0; position: fixed;">
        <div class="container-fluid" style="height: 70px;">
          <div class="custom-menu" style="position: absolute; top: 10px;">
            <button type="button" id="sidebarCollapse" class="btn btn-primary btn-lg"
              style="z-index: 9;color: white;background: transparent;border-radius: unset;padding-right: 2em; border: transparent;">
              <i class="fa fa-bars" aria-hidden="true" style="z-index: 9; font-size: 1.5em;"></i>
            </button>
          </div>
          <div class="navbar-header" style="position: absolute; left: 85px;">
            <h1 class="cursive"><a href="/dispatch-dashboard"><i class="fa-solid fa-headset"></i> Dispatch Operations</a> ‚Ä¢ <a href="/community-dashboard"><span id="community-name"></span></a></h1>
          </div>
        </div>
        <a data-toggle="modal" href="#signal100DetailModal" style="z-index: 8;width: 100%;">
          <div id="signal-100-banner" class="panel panel-danger hide">
            <div class="panel-heading">
              <span class="panel-title">üö®üö®üö® Signal 100 In Effect! üö®üö®üö®</span>
              <button type="button" class="close" aria-label="Close"
                style="position: absolute; margin-top: 5px; margin-left: 1em;">
                <i class="fa fa-times"></i> Clear
              </button>
            </div>
          </div>
        </a>
        <a data-toggle="modal" href="#holdTrafficDetailModal" style="z-index: 8;width: 100%;">
          <div id="hold-traffic-banner" class="panel panel-warning hide">
            <div class="panel-heading">
              <span class="panel-title">‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è 10-3 Active: hold all radio traffic! ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è</span>
              <button type="button" class="close" aria-label="Close"
                style="position: absolute; margin-top: 5px; margin-left: 1em;">
                <i class="fa fa-times"></i> Clear
              </button>
            </div>
          </div>
        </a>
      </nav>

      <header id="second" style='background-image: url("/static/images/city-skyline.jpg");'>

        <div class="header-content margin-top-2">
          <div class="inner">

            <% if (context=="createTicketSuccess" ) {%>
              <div class="alert alert-success alert-dismissible show" role="alert">
                <strong>Success!</strong> Citation created successfully
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <% } else if (context=="createWarningSuccess" ) {%>
                <div class="alert alert-success alert-dismissible show" role="alert">
                  <strong>Success!</strong> Warning created successfully
                  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <% } else if (context=="createArrestSuccess" ) {%>
                  <div class="alert alert-success alert-dismissible show" role="alert">
                    <strong>Success!</strong> Arrest created successfully
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <% } else if (context=="createWarrantSuccess" ) {%>
                    <div class="alert alert-success alert-dismissible show" role="alert">
                      <strong>Success!</strong> Warrant created successfully
                      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <% } else if (context=="createBoloSuccess" ) {%>
                      <div class="alert alert-success alert-dismissible show" role="alert">
                        <strong>Success!</strong> Bolo created successfully
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <%}%>

                        <!-- imports the community specific alerts -->
                        <% include community-alerts %>
                          <!-- <div class="col-md-10 col-md-offset-1 text-center">
                            <% if (user.user.activeCommunity !='' && user.user.activeCommunity !=null) {%>
                              <button type="button" class="btn btn-danger btn-lg margin-top-2 margin-bottom-1"
                                onclick="signal100()"><i class="fa fa-exclamation-circle" aria-hidden="true"></i>
                                Signal 100</button>
                                <button type="button" class="btn btn-warning btn-lg margin-top-2 margin-bottom-1"
                                onclick="holdTraffic()"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                                10-3</button>
                              <% } else {%>
                                <button type="button" data-toggle="modal" href="#nonCommunityBoloModal"
                                  class="btn btn-danger btn-lg margin-top-2 mock-disabled margin-bottom-1"><i
                                    class="fa fa-exclamation-circle" aria-hidden="true"></i> Signal 100</button>
                                <% } %>
                          </div> -->
                          <% if (user.user.activeCommunity =='' || user.user.activeCommunity ==null) {%>
                            <div class="col-md-10 col-md-offset-1 text-center">
                              <h3><i class="fa fa-arrow-left"></i> Click on any of the search buttons to get started
                              </h3>
                              <hr style="width: 88%;max-width: 100rem;">
                              <h4>Looks like you are not in a community, click here to get started!</h4>
                              <p><a data-toggle="modal" href="#communitiesModal">Create/Join A Community</a></p>
                            </div>
                            <%} else {%>
                              <hr style="width: 88%;max-width: 100rem;">
                              <!-- officer list -->
                              <h4 id="officer-list">Unit List: </h4>
                              <table id="officerListTable" class="table table-hover table-bordered">
                                <thead>
                                  <tr>
                                    <th>Username</th>
                                    <th>Call Sign</th>
                                    <th>Status</th>
                                  </tr>
                                </thead>
                                <tbody></tbody>
                              </table>

                              <hr style="width: 88%;max-width: 100rem;">
                              
                            <%}%>
          </div>

        </div>
      </header>
      <div class="adsbygoogle">
        <% include ad-body %>
      </div>
      <section style='background-image: url("/static/images/blue-clouds.jpg"); padding: 0;'>
        <div class="container">
          <div class="col-lg-10 col-lg-offset-1 margin-top-1">
            
                  <div id="panic-placeholder"></div>
                  <div id="panic-placeholder-socket"></div>
                
          </div>
        </div>

        
        <div class="container">
          <% if (user.user.activeCommunity !='' && user.user.activeCommunity != null) {%>
          <!-- <div class="col-md-12 col-md-offset-0.75 margin-top-2 margin-bottom-2">
            
            <h4 id="fireEms-list">Fire/EMS List: <a data-toggle="modal" href="#fireEMSHelpModal"><i class="fa fa-question-circle"></i></a> </h4>
            <table id="fireEmsListTable" class="table table-hover table-bordered">
              <thead>
                <tr>
                  <th>Engine #</th>
                  <th>Model</th>
                  <th>Status</th>
                </tr>
              </thead>
            </table>
          </div> -->

          <hr style="width: 88%;max-width: 100rem;">
          <%}%>
          <div id="active-bolo-container" class="col-md-12 col-md-offset-0.75 margin-top-2">
            <% if (user.user.activeCommunity !='' && user.user.activeCommunity !=null) {%>
              <span id="active-bolos" class="margin-right-1" style="font-size: 18px;">Active BOLOs:</span> <button
                type="button" data-toggle="modal" href="javascript:void(0)"
                class="btn btn-primary btn-md pull-right margin-bottom-1" onclick="showBoloModal()">Create BOLO</button>
                <!-- <a href="javascript:void(0)" onclick="showBoloModal()"><span
      class="fa fa-exclamation-triangle ml-3 mr-3"></span>Create BOLO</a> -->
              <table id="boloTable" class="table table-hover table-bordered">
  <thead>
    <tr>
      <th>Type</th>
      <th>Location</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <!-- Populated dynamically by loadBolos -->
  </tbody>
</table>
              <% } %>
          </div>
          <div class="col-md-12 col-md-offset-0.75 margin-top-2">
              <hr style="width: 88%;max-width: 100rem;">
              <!-- Active Calls -->
              <span id="active-bolos" class="margin-right-1" style="font-size: 18px;">Active Calls:</span> <button
                type="button" data-toggle="modal" href="#callModal"
                class="btn btn-primary btn-md pull-right margin-bottom-1"
                onclick="">Create Call</button>
              <table id="callTable" class="table table-hover table-bordered">
  <thead>
    <tr>
      <th>Created At</th>
      <th>Description</th>
      <th>Units Assigned</th>
    </tr>
  </thead>
  <tbody>
    <!-- Populated dynamically by loadAssignedCalls -->
  </tbody>
</table>

          </div>
        </div>
      </section>
      <div class="google-ad"></div>
      <% include footer %>
    </div>
  </div>



  <div id="galleryModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-body">
          <img src="" id="galleryImage" class="img-responsive" />
          <p>
            <br />
            <button class="btn btn-primary btn-lg center-block" data-dismiss="modal" aria-hidden="true">Close
              <i class="ion-android-close"></i></button>
          </p>
        </div>
      </div>
    </div>
  </div>

 <% include search-database %>
  <% include details-modal %>
  
  <div id="viewLicense" class="modal fade" style="z-index: 9000" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
            <form class="form-horizontal" action="/updateOrDeleteLicense" method="post">
              <fieldset>

            <!-- Form Name -->
            <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal" aria-hidden="true">X</button>
            <h4>License Details:</h4>
            <hr style="width: 88%;max-width: 100rem;">

            <div class="form-group">
              <label class="col-md-3 control-label" for="license-type">License Type:</label>
              <div class="col-md-5">
                <select id="license-type-details" name="licenseType" class="form-control disabled-color" required="" readonly="readonly">
                  <% include license-list %>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label class="col-md-3 control-label" for="license-status"><i id="isSuspendedAlert" class="fa-solid fa-circle-exclamation color-alert-red"></i> License Status:</label>
              <div class="col-md-5">
                <select id="license-status-details" name="licenseStatus" class="form-control disabled-color" required="" readonly="readonly">
                  <option value="pending">Pending</option>
                  <option value="valid">Valid</option>
                  <option value="expired">Expired</option>
                  <option value="suspended">Suspended</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label class="col-md-3 control-label" for="expirationDate">Expiration Date:</label>
              <div class="col-md-5">
              <input id="expirationDate-details" name="expirationDate" type="date" max="2999-12-31" min="1900-01-01" class="form-control input-md disabled-color" required="" readonly="readonly">
              </div>
            </div>

            <div class="form-group">
              <label class="col-md-3 control-label" for="additionalNotes">Additional Notes:</label>
              <div class="col-md-8">
                <input id="additionalNotes-details" name="additionalNotes" type="text" placeholder="additional notes" class="form-control input-md disabled-color" required="" readonly="readonly">
              </div>
            </div>

            <div class="col-md-12 text-align-center margin-bottom-2">
                <input type="hidden" id="licenseID" name="licenseID">
                <input type="hidden" id="licenseOwnerID" name="licenseOwnerID">
                <input type="hidden" name="backLocation" value="/dispatch-dashboard">
                <button type="submit" id="reinstateLicenseBtn" value="update" name="action" class="btn btn-info" onclick="updateToReinstated()">Reinstate License</button>
                <button type="submit" id="suspendLicenseBtn" value="update" name="action" class="btn btn-danger" onclick="updateToSuspended()">Suspend License</button>
            </div>
            </fieldset>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div id="viewVeh" class="modal fade" style="z-index: 9000" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
            <form class="form-horizontal" action="/updateOrDeleteVeh" method="post">
              <fieldset>

            <!-- Form Name -->
            <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal" aria-hidden="true">X</button>
            <h4>Vehicle Details:</h4>
            <hr style="width: 88%;max-width: 100rem;">

            <!-- Text input-->
            <div class="form-group">
              <label class="col-md-4 control-label" for="vinVeh">Vin #</label>
              <div class="col-md-4">
                <input id="vinVeh" name="vinVeh" type="text" minlength="17" maxlength="17" class="form-control input-md disabled-color" required readonly="readonly">
              </div>
              <div id="no-existing-vin" class="col-md-4">
                <button type="button" class="btn btn-info btn-md" onclick="generateSerialNumber(17, 'vinVeh')">Generate</button>
              </div>
            </div>

            <div class="form-group">
              <label class="col-md-4 control-label" for="roVeh">Owner:</label>
              <button id="lookupButton" data-toggle="modal" href="#nameSearchResults" data-dismiss="modal" aria-hidden="true" class="btn btn-info btn-md" style="margin-left: 1em; margin-bottom: 1em;"><i class="fa-solid fa-magnifying-glass"></i> Lookup</button>
              <div class="col-md-4">
                <input id="roVeh" name="roVeh" type="text" class="form-control input-md disabled-color capitalize" required readonly="readonly">
              </div>
            </div>

            <div class="form-group">
                <label class="col-md-4 control-label" for="plate">Plate:</label>
                <div class="col-md-4">
                  <input id="plateVeh" name="plateVeh" type="text" maxlength="8" placeholder="Plate" class="form-control input-md disabled-color" required readonly="readonly">
                </div>
              </div>

            <div class="form-group">
                <label class="col-md-4 control-label" for="model">Model:</label>
                <div class="col-md-4">
                  <input id="modelVeh" name="modelVeh" type="search" placeholder="Model" class="form-control input-md disabled-color" required readonly="readonly">
                </div>
              </div>

            <div class="form-group">
                <label class="col-md-4 control-label" for="colorView">Color:</label>
                <div class="col-md-4">
                  <input id="colorView" name="colorView" type="text" placeholder="Color" class="form-control input-md disabled-color" required readonly="readonly">
                </div>
              </div>

            <div class="form-group">
                <label class="col-md-4 control-label" for="valid-registration"><i id="invalidRegistrationAlert" class="fa-solid fa-triangle-exclamation color-yellow"></i> Valid Registration?</label>
                <div class="col-md-4">
                  <select id="validRegView" name="validRegView" class="form-control disabled-color" selected="selected" required readonly="readonly">
                    <option value="1">Yes</option>
                    <option value="2">No</option>
                  </select>
                </div>
              </div>

            <div class="form-group">
                <label class="col-md-4 control-label" for="validInsView"><i id="invalidInsuranceAlert" class="fa-solid fa-triangle-exclamation color-yellow"></i> Valid Insurance?</label>
                <div class="col-md-4">
                  <select id="validInsView" name="validInsView" class="form-control disabled-color" selected="selected" required readonly="readonly">
                    <option value="1">Yes</option>
                    <option value="2">No</option>
                  </select>
                </div>
              </div>

            <div class="form-group">
                <label class="col-md-4 control-label" for="stolenView"><i id="isStolenAlert" class="fa-solid fa-circle-exclamation color-alert-red"></i> Marked Stolen?</label>
                <div class="col-md-4">
                  <select id="stolenView" name="stolenView" class="form-control disabled-color" selected="selected" required readonly="readonly">
                    <option value="1">No</option>
                    <option value="2">Yes</option>
                  </select>
                </div>
              </div>

            <div class="col-md-12 text-align-center">
                <input type="hidden" id="vehicleID" name="vehicleID">
                <input type="hidden" name="backLocation" value="/dispatch-dashboard">
                <button id="markStolenBtn" type="submit" value="update" name="action" class="btn btn-danger" onclick="updateToIsStolen()">Mark Stolen</button>
                <!-- <button type="submit" value="delete" name="action" class="btn btn-danger">Delete Vehicle</button> -->
            </div>
            </fieldset>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div id="boloDetailModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        <form id="update-bolo-form" class="form-horizontal" onsubmit="event.preventDefault(); handleUpdateBolo();">
          <fieldset>
            <!-- Form Name -->
            <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal" aria-hidden="true">X</button>
            <h4>BOLO Details</h4>
            <hr style="width: 88%;max-width: 100rem;">

            <!-- Text input-->
            <div class="form-group required">
              <label class="col-md-4 control-label" for="boloTitleDetail">Title:</label>
              <div class="col-md-4">
                <input id="boloTitleDetail" name="boloTitle" style="text-transform: capitalize;" type="text"
                  placeholder="Title" class="form-control input-md" maxlength="50" required>
              </div>
            </div>

            <!-- Text input-->
            <div class="form-group required">
              <label class="col-md-4 control-label" for="locationDetail">Location:</label>
              <div class="col-md-4">
                <input id="locationDetail" name="location" style="text-transform: capitalize;" type="text"
                  placeholder="Location" class="form-control input-md" maxlength="50" required>
              </div>
            </div>

            <!-- Text Area input-->
            <div class="form-group required">
              <label class="col-md-4 control-label" for="descriptionDetail">Description:</label>
              <div class="col-md-8 col-md-offset-2">
                <textarea id="descriptionDetail" name="description" rows="4" maxlength="500"
                  placeholder="Description" class="form-control input-md" required></textarea>
              </div>
            </div>

            <div class="form-group">
              <label class="col-md-4 control-label" for="dateCreatedDetail">Date Created:</label>
              <div class="col-md-4">
                <h5 id="dateCreatedDetail"></h5>
              </div>
            </div>

            <div class="form-group">
              <label class="col-md-4 control-label" for="lastUpdatedDetail">Last Updated:</label>
              <div class="col-md-4">
                <h5 id="lastUpdatedDetail"></h5>
              </div>
            </div>

            <div class="form-group">
              <label class="col-md-4 control-label" for="statusDetail">Status:</label>
              <div class="col-md-4">
                <h5 id="statusDetail"></h5>
              </div>
            </div>

            <!-- Hidden input for boloID -->
            <input id="boloIDDetail" type="hidden" name="boloID" value="">

            <!-- Button -->
            <div class="form-group">
              <label class="col-md-4 control-label" for="updateBolo"></label>
              <div class="col-md-4 text-align-center">
                <button id="updateBolo" type="submit" class="btn btn-info">Update</button>
              </div>
            </div>
          </fieldset>
        </form>
        <form id="delete-bolo-form" onsubmit="event.preventDefault(); handleDeleteBolo();">
          <fieldset>
            <div class="form-group">
              <label class="col-md-4 control-label" for="deleteBolo"></label>
              <div class="col-md-4 text-align-center">
                <button id="deleteBolo" type="submit" class="btn btn-danger">Delete</button>
              </div>
            </div>
          </fieldset>
        </form>
      </div>
    </div>
  </div>
</div>

  <div id="viewWarrant" class="modal fade" style="z-index: 9000" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <form id="warrant-form" class="form-horizontal" action="/updateOrDeleteWarrant" method="POST">
            <fieldset>

              <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
                aria-hidden="true">X</button>
              <h4>Warrant Details</h4>
              <hr style="width: 88%;max-width: 100rem;">

              <div class="form-group">
                <label class="col-md-4 control-label" for="view-warrant-civ-first-name">First Name:</label>
                <div class="col-md-4">
                  <input id="view-warrant-civ-first-name" name="accusedFirstName" type="text" placeholder="First Name"
                    class="form-control input-md disabled-color" style="text-transform:capitalize;" required="" readonly="readonly">
                </div>
              </div>

              <div class="form-group">
                <label class="col-md-4 control-label" for="view-warrant-civ-last-name">Last Name:</label>
                <div class="col-md-4">
                  <input id="view-warrant-civ-last-name" name="accusedLastName" type="text" placeholder="Last Name"
                    class="form-control input-md disabled-color" style="text-transform:capitalize;" required="" readonly="readonly">
                </div>
              </div>

              <div class="form-group">
                <label class="col-md-4 control-label" for="view-warrant-civ-dob">DOB:</label>
                <div class="col-md-4">
                  <input id="view-warrant-civ-dob" name="dateOfBirth" type="date" placeholder="mm/dd/yyyy"
                    class="form-control input-md disabled-color" required="" readonly="readonly">
                </div>
              </div>

              <div class="form-group" style="display:none">
                <label class="col-md-4 control-label" for="view-civIDWarrant">Selected ID:</label>
                <div class="col-md-4">
                  <input id="view-civIDWarrant" name="accusedID" type="text" placeholder="Autofill from searching"
                    class="form-control input-md disabled-color" data-trigger="warrant-id-popover"
                    data-content="* ID is required, try using the search button above." required readonly="readonly">
                </div>
              </div>

              <div class="form-group">
                <label class="col-md-4 control-label" for="charge">Warrant Reason:</label>
                <div class="col-md-4">
                  <select id="view-warrant-select" class="form-control disabled-color" name="reasons" disabled>
                    <option>Failure to Appear</option>
                    <option>Murder</option>
                    <option>Felony Evasion</option>
                    <option>Prison Escape</option>
                    <option id="view-warrant-other-option">Other</option>
                  </select>
                </div>
              </div>

              <div id="view-warrant-other-div" class="form-group required" style="display:none">
                <label class="col-md-4 control-label" for="warrant-other">Other:</label>
                <div class="col-md-4">
                  <input id="view-warrant-other" name="other" type="text" placeholder="other" class="form-control input-md"
                    style="text-transform:capitalize;">
                </div>
              </div>

              <input id="view-warrant-date" type="hidden" name="date" value="">
              <input id="view-warrant-time" type="hidden" name="time" value="">
              <input id="view-warrant-reportingOfficer" type="hidden" name="reportingOfficer" value=<%=user.user.username%>>
              <!-- Button -->
              <div class="form-group">
                <label class="col-md-4 control-label" for="submitWarrantCreation"></label>
                <div class="col-md-4">
                  <input type="hidden" name="route" value="dispatch-dashboard">
                  <button type="button" class="btn btn-info margin-bottom-05" id="confirmWarrantModal" data-toggle="modal" href="#confirmClearWarrantModal" onclick="clearWarrantWithValues()">Clear</button>
                </div>
              </div>
            </fieldset>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div id="ticketModal" class="modal fade" style="z-index: 9000" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <form id="ticket-form" class="form-horizontal" action="/create-ticket" method="POST">
            <fieldset>

              <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
                aria-hidden="true">X</button>
              <h4>Issue Citation</h4>
              <hr style="width: 88%;max-width: 100rem;">

              <div class="form-group required">
                <label class="col-md-4 control-label" for="plate">Date of Violation</label>
                <div class="col-md-4">
                  <input id="date" name="date" type="date" min="1900-01-01" max="2999-12-31"
                    class="form-control input-md disabled-color" required="">
                </div>
              </div>

              <div class="form-group required">
                <label class="col-md-4 control-label" for="time">Time</label>
                <div class="col-md-4">
                  <input id="time" name="time" type="time" placeholder="hh:mm" class="form-control input-md disabled-color" required="">
                </div>
              </div>

              <div class="form-group">
                <label class="col-md-4 control-label" for="ticket-civ-first-name">First Name</label>
                <div class="col-md-4">
                  <input id="ticket-civ-first-name" name="civFirstName" type="text" placeholder="First Name"
                    class="form-control input-md disabled-color" data-trigger="first-name-popover"
                    data-content="* Please select from dropdown." style="text-transform:capitalize;" readonly="readonly">
                </div>
              </div>

              <div class="form-group">
                <label class="col-md-4 control-label" for="ticket-civ-last-name">Last Name</label>
                <div class="col-md-4">
                  <input id="ticket-civ-last-name" name="civLastName" type="text" placeholder="Last Name"
                    class="form-control input-md disabled-color" data-trigger="last-name-popover"
                    data-content="* Last name cannot contain spaces." style="text-transform:capitalize;" readonly="readonly">
                </div>
              </div>

              <div class="form-group">
                <label class="col-md-4 control-label" for="ticket-civ-dob">DOB</label>
                <div class="col-md-4">
                  <input id="ticket-civ-dob" name="dateOfBirth" type="date" placeholder="mm/dd/yyyy"
                    class="form-control input-md disabled-color" readonly="readonly">
                </div>
              </div>

              <div class="form-group" style="display:none">
                <label class="col-md-4 control-label" for="civID">Selected ID</label>
                <div class="col-md-4">
                  <input id="civID" name="civID" type="text" placeholder="Autofill from searching"
                    class="form-control input-md disabled-color" data-trigger="id-popover"
                    data-content="* ID is required, try using the search button above." required readonly="readonly">
                </div>
              </div>

              <div class="form-group">
                <label class="col-md-4 control-label" for="plate">Plate</label>
                <div class="col-md-4">
                  <input id="plate" name="plate" type="text" maxlength="8" placeholder="plate"
                    class="form-control input-md">
                </div>
              </div>

              <div class="form-group">
                <label class="col-md-4 control-label" for="model">Model</label>
                <div class="col-md-4">
                  <input id="model" name="model" type="text" placeholder="model" class="form-control input-md"
                    style="text-transform:capitalize;">
                </div>
              </div>

              <div class="form-group">
                <label class="col-md-4 control-label" for="color">Color</label>
                <div class="col-md-4">
                  <input id="color" name="color" type="text" placeholder="color" class="form-control input-md"
                    style="text-transform:capitalize;">
                </div>
              </div>

              <!-- Multiple Checkboxes (inline) -->
              <div class="form-group required">
                <label class="col-md-4 control-label" for="fines">Fines</label>
                <div class="col-md-4">

                  <select id="ticket-select" name="fines" class="select-move" multiple required>
                    <% include citation-list %>
                      <optgroup label="Crime not listed">
                        <option id="ticket-option-other">Other</option>
                      </optgroup>
                  </select>
                </div>
              </div>

              <div id="ticket-other-div" class="form-group required" style="display:none">
                <label class="col-md-4 control-label" for="ticket-other">Other</label>
                <div class="col-md-4">
                  <input id="ticket-other" name="other" type="text" placeholder="other" class="form-control input-md"
                    style="text-transform:capitalize;">
                </div>
              </div>

              <!-- Text input-->
              <div class="form-group required">
                <label class="col-md-4 control-label" for="amount">Fine Amount</label>
                <div class="col-md-4">
                  <input id="amount" name="amount" type="number" placeholder="$ amount" max="999999"
                    class="form-control input-md" required="">
                </div>
              </div>
              <input type="hidden" name="isWarning" value="false">
              <!-- Button -->
              <div class="form-group">
                <label class="col-md-4 control-label" for="submitTicket"></label>
                <div class="col-md-4">
                  <input id="crimeList" type="hidden" name="crimeList" value="">
                  <input type="hidden" name="officerID" value="<%=user._id%>">
                  <input type="hidden" name="route" value="dispatch-dashboard">
                  <button id="submitTicket" class="btn btn-primary" onclick="hideTicketCivPopover()">Submit</button>
                </div>
              </div>
            </fieldset>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div id="warningModal" class="modal fade" style="z-index: 9000" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <form id="warning-form" class="form-horizontal" action="/create-ticket" method="POST">
            <fieldset>

              <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
                aria-hidden="true">X</button>
              <h4>Issue Warning</h4>
              <hr style="width: 88%;max-width: 100rem;">

              <div class="form-group required">
                <label class="col-md-4 control-label" for="warning-date">Date of Violation</label>
                <div class="col-md-4">
                  <input id="warning-date" name="date" type="date" min="1900-01-01" max="2999-12-31"
                    class="form-control input-md" required="">
                </div>
              </div>

              <div class="form-group required">
                <label class="col-md-4 control-label" for="warning-time">Time</label>
                <div class="col-md-4">
                  <input id="warning-time" name="time" type="time" placeholder="hh:mm" class="form-control input-md"
                    required="">
                </div>
              </div>

              <div class="form-group">
                <label class="col-md-4 control-label" for="warning-civ-first-name">First Name</label>
                <div class="col-md-4">
                  <input id="warning-civ-first-name" name="civFirstName" type="text" placeholder="First Name"
                    class="form-control input-md disabled-color" style="text-transform:capitalize;" readonly="readonly">
                </div>
              </div>

              <div class="form-group">
                <label class="col-md-4 control-label" for="warning-civ-last-name">Last Name</label>
                <div class="col-md-4">
                  <input id="warning-civ-last-name" name="civLastName" type="text" placeholder="Last Name"
                    class="form-control input-md disabled-color" style="text-transform:capitalize;" readonly="readonly">
                </div>
              </div>

              <div class="form-group">
                <label class="col-md-4 control-label" for="warning-civ-dob">DOB</label>
                <div class="col-md-4">
                  <input id="warning-civ-dob" name="dateOfBirth" type="date" placeholder="mm/dd/yyyy"
                    class="form-control input-md disabled-color" readonly="readonly">
                </div>
              </div>

              <div class="form-group" style="display:none">
                <label class="col-md-4 control-label" for="civIDWarning">Selected ID</label>
                <div class="col-md-4">
                  <input id="civIDWarning" name="civID" type="text" placeholder="Autofill from searching"
                    class="form-control input-md disabled-color" data-trigger="warning-id-popover"
                    data-content="* ID is required, try using the search button above." required readonly="readonly">
                </div>
              </div>

              <div class="form-group">
                <label class="col-md-4 control-label" for="warning-plate">Plate</label>
                <div class="col-md-4">
                  <input id="warning-plate" name="plate" type="text" maxlength="8" placeholder="plate"
                    class="form-control input-md">
                </div>
              </div>

              <div class="form-group">
                <label class="col-md-4 control-label" for="warning-model">Model</label>
                <div class="col-md-4">
                  <input id="warning-model" name="model" type="text" placeholder="model" class="form-control input-md"
                    style="text-transform:capitalize;">
                </div>
              </div>

              <div class="form-group">
                <label class="col-md-4 control-label" for="warning-color">Color</label>
                <div class="col-md-4">
                  <input id="warning-color" name="color" type="text" placeholder="color" class="form-control input-md"
                    style="text-transform:capitalize;">
                </div>
              </div>

              <!-- Multiple Checkboxes (inline) -->
              <div class="form-group required">
                <label class="col-md-4 control-label" for="fines">Violation</label>
                <div class="col-md-4">

                  <select id="warning-select" name="fines" class="select-move" multiple required>
                    <% include citation-list %>
                      <optgroup label="Crime not listed">
                        <option id="warning-option-other">Other</option>
                      </optgroup>
                  </select>
                </div>
              </div>

              <div id="warning-other-div" class="form-group required" style="display:none">
                <label class="col-md-4 control-label" for="warning-other">Other</label>
                <div class="col-md-4">
                  <input id="warning-other" name="other" type="text" placeholder="other" class="form-control input-md"
                    style="text-transform:capitalize;">
                </div>
              </div>

              <input type="hidden" name="isWarning" value="true">
              <input type="hidden" name="amount" value="0">
              <!-- Button -->
              <div class="form-group">
                <label class="col-md-4 control-label" for="submitWarning"></label>
                <div class="col-md-4">
                  <input type="hidden" name="route" value="dispatch-dashboard">
                  <input id="warningCrimeList" type="hidden" name="crimeList" value="">
                  <button id="submitWarning" class="btn btn-primary" onclick="hideWarningCivPopover()">Submit</button>
                </div>
              </div>
            </fieldset>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div id="arrestModal" class="modal fade" style="z-index: 9000" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <form id="arrest-form" class="form-horizontal" action="/create-arrest-report" method="POST">
            <fieldset>

              <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
                aria-hidden="true">X</button>
              <h4>San Andreas Arrest Report</h4>
              <hr style="width: 88%;max-width: 100rem;">

              <div class="form-group required">
                <label class="col-md-4 control-label" for="arrest-report-case-no">Case No:</label>
                <div class="col-md-4">
                  <input id="arrest-report-case-no" name="caseNumber" type="number" class="form-control input-md"
                    readonly="readonly">
                </div>
              </div>

              <div class="form-group required">
                <label class="col-md-4 control-label" for="arrest-report-date">Date of Violation:</label>
                <div class="col-md-4">
                  <input id="arrest-report-date" name="date" type="date" min="1900-01-01" max="2999-12-31"
                    class="form-control input-md" required="">
                </div>
              </div>

              <div class="form-group required">
                <label class="col-md-4 control-label" for="arrest-report-time">Time:</label>
                <div class="col-md-4">
                  <input id="arrest-report-time" name="time" type="time" placeholder="hh:mm"
                    class="form-control input-md" required="">
                </div>
              </div>

              <div class="form-group required">
                <label class="col-md-4 control-label" for="reporting-officer">Reporting Officer:</label>
                <div class="col-md-4">
                  <input id="reporting-officer" name="reportingOfficer" type="text" placeholder="Reporting Officer"
                    class="form-control input-md" style="text-transform:capitalize;" value=<%=user.user.username%>
                  required="" readonly="readonly">
                </div>
              </div>

              <div class="form-group required">
                <label class="col-md-4 control-label" for="arrest-civ-first-name">First Name</label>
                <div class="col-md-4">
                  <input id="arrest-civ-first-name" name="accusedFirstName" type="text" placeholder="First Name"
                    class="form-control input-md" style="text-transform:capitalize;" required="">
                </div>
              </div>

              <div class="form-group required">
                <label class="col-md-4 control-label" for="arrest-civ-last-name">Last Name</label>
                <div class="col-md-4">
                  <input id="arrest-civ-last-name" name="accusedLastName" type="text" placeholder="Last Name"
                    class="form-control input-md" style="text-transform:capitalize;" required="">
                </div>
              </div>

              <div class="form-group required">
                <label class="col-md-4 control-label" for="arrest-civ-dob">DOB</label>
                <div class="col-md-4">
                  <input id="arrest-civ-dob" name="dateOfBirth" type="date" placeholder="mm/dd/yyyy"
                    class="form-control input-md" required="">
                </div>
              </div>

              <div class="form-group" style="display:none">
                <label class="col-md-4 control-label" for="civIDArrest">Selected ID</label>
                <div class="col-md-4">
                  <input id="civIDArrest" name="accusedID" type="text" placeholder="Autofill from searching"
                    class="form-control input-md disabled-color" data-trigger="arrest-id-popover"
                    data-content="* ID is required, try using the search button above." required readonly="readonly">
                </div>
              </div>

              <div class="form-group required">
                <label class="col-md-4 control-label" for="charge">Charge(s)</label>
                <div class="col-md-4">
                  <input id="charge" name="charges" type="text" maxlength="500" placeholder="Charge(s)"
                    class="form-control input-md" required="">
                </div>
              </div>

              <hr />

              <div class="form-group">
                <label class="col-md-4 control-label" for="detail">Detail of
                  Event:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
                <div class="col-md-10 col-md-offset-1">
                  <textarea id="detail" name="detailOfEvent" type="text" maxlength="500" placeholder="Detail"
                    class="form-control input-md" required></textarea>
                </div>
              </div>

              <div class="form-group">
                <label class="col-md-4 control-label" for="actions-taken">Actions
                  Taken:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
                <div class="col-md-10 col-md-offset-1">
                  <textarea id="actions-taken" name="actionsTaken" type="text" maxlength="500"
                    placeholder="Actions Taken" class="form-control input-md" required></textarea>
                </div>
              </div>

              <div class="form-group">
                <label class="col-md-4 control-label"
                  for="summary">Summary:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
                <div class="col-md-10 col-md-offset-1">
                  <textarea id="summary" name="summary" type="text" maxlength="500" placeholder="Summary"
                    class="form-control input-md" required></textarea>
                </div>
              </div>

              <!-- Button -->
              <div class="form-group">
                <label class="col-md-4 control-label" for="submitArrestReport"></label>
                <div class="col-md-4">
                  <input type="hidden" name="reportingOfficerID" value="<%=user._id%>">
                  <input type="hidden" name="route" value="dispatch-dashboard">
                  <button id="submitArrestReport" class="btn btn-primary"
                    onclick="hideArrestReportPopover()">Submit</button>
                </div>
              </div>
            </fieldset>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div id="createWarrantModal" class="modal fade" style="z-index: 9000" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <form id="warrant-form" class="form-horizontal" action="/create-warrant" method="POST">
            <fieldset>

              <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
                aria-hidden="true">X</button>
              <h4>Create Warrant</h4>
              <hr style="width: 88%;max-width: 100rem;">

              <div class="form-group required">
                <label class="col-md-4 control-label" for="warrant-civ-first-name">First Name</label>
                <div class="col-md-4">
                  <input id="warrant-civ-first-name" name="accusedFirstName" type="text" placeholder="First Name"
                    class="form-control input-md" style="text-transform:capitalize;" required="" readonly="readonly">
                </div>
              </div>

              <div class="form-group required">
                <label class="col-md-4 control-label" for="warrant-civ-last-name">Last Name</label>
                <div class="col-md-4">
                  <input id="warrant-civ-last-name" name="accusedLastName" type="text" placeholder="Last Name"
                    class="form-control input-md" style="text-transform:capitalize;" required="" readonly="readonly">
                </div>
              </div>

              <div class="form-group required">
                <label class="col-md-4 control-label" for="warrant-civ-dob">DOB</label>
                <div class="col-md-4">
                  <input id="warrant-civ-dob" name="dateOfBirth" type="date" placeholder="mm/dd/yyyy"
                    class="form-control input-md" required="" readonly="readonly">
                </div>
              </div>

              <div class="form-group" style="display:none">
                <label class="col-md-4 control-label" for="civIDWarrant">Selected ID</label>
                <div class="col-md-4">
                  <input id="civIDWarrant" name="accusedID" type="text" placeholder="Autofill from searching"
                    class="form-control input-md disabled-color" data-trigger="warrant-id-popover"
                    data-content="* ID is required, try using the search button above." required readonly="readonly">
                </div>
              </div>

              <div class="form-group required">
                <label class="col-md-4 control-label" for="charge">Warrant Reason</label>
                <div class="col-md-4">
                  <select id="warrant-select" name="reasons">
                    <option>Failure to Appear</option>
                    <option>Murder</option>
                    <option>Felony Evasion</option>
                    <option>Prison Escape</option>
                    <option id="warrant-other-option">Other</option>
                  </select>
                </div>
              </div>

              <div id="warrant-other-div" class="form-group required" style="display:none">
                <label class="col-md-4 control-label" for="warrant-other">Other</label>
                <div class="col-md-4">
                  <input id="warrant-other" name="other" type="text" placeholder="other" class="form-control input-md"
                    style="text-transform:capitalize;">
                </div>
              </div>

              <input id="warrant-date" type="hidden" name="date" value="">
              <input id="warrant-time" type="hidden" name="time" value="">
              <input id="warrant-reportingOfficer" type="hidden" name="reportingOfficer" value=<%=user.user.username%>>
              <!-- Button -->
              <div class="form-group">
                <label class="col-md-4 control-label" for="submitWarrantCreation"></label>
                <div class="col-md-4">
                  <input type="hidden" name="route" value="dispatch-dashboard">
                  <button id="submitWarrantCreation" class="btn btn-primary">Submit</button>
                </div>
              </div>
            </fieldset>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div id="confirmClearWarrantModal" class="modal fade" style="z-index: 9999;" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <form id="warrant-clear-form" class="form-horizontal" action="/clear-warrant" method="POST">
            <fieldset>

              <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
                aria-hidden="true">X</button>
              <h4>Clear Warrant?</h4>
              <hr style="width: 88%;max-width: 100rem;">

              <p id="warrant-reason"></p>
              <!-- <input id="warrant-clear-date" type="hidden" name="updatedDate" value=""> -->
              <!-- <input id="warrant-clear-time" type="hidden" name="updatedTime" value=""> -->
              <input id="warrant-clearingOfficer" type="hidden" name="clearingOfficerID" value=<%=user._id%>>
              <input id="warrant-ID" type="hidden" name="warrantID" value="">
              <!-- Button -->

              <div class="form-group">
                <label class="col-md-4 control-label" for="submitWarrantCreation"></label>
                <div class="col-md-4">
                  <input type="hidden" name="route" value="dispatch-dashboard">
                  <button id="submitWarrantClearCreation" class="btn btn-success"
                    onclick="hideWarrantClearPopover()">Yes</button>
                  <button class="btn btn-danger" data-dismiss="modal">No</button>
                </div>
              </div>
            </fieldset>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div id="boloModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <form id="create-bolo-form" class="form-horizontal" onsubmit="event.preventDefault(); handleCreateBolo();">
          <fieldset>
            <!-- Form Name -->
            <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal" aria-hidden="true">X</button>
            <h4>Create BOLO Alert</h4>
            <hr style="width: 88%;max-width: 100rem;">

            <!-- Text input: Title -->
            <div class="form-group required">
              <label class="col-md-4 control-label" for="boloTitle">Title:</label>
              <div class="col-md-4">
                <input id="boloTitle" name="title" style="text-transform: capitalize;" type="text"
                  placeholder="Title" class="form-control input-md" maxlength="50" required>
              </div>
            </div>

            <!-- Text input: Location -->
            <div class="form-group required">
              <label class="col-md-4 control-label" for="boloLocation">Last Seen Around:</label>
              <div class="col-md-4">
                <input id="boloLocation" name="location" style="text-transform: capitalize;" type="text"
                  placeholder="Location" class="form-control input-md" maxlength="50" required>
              </div>
            </div>

            <!-- Textarea: Description -->
            <div class="form-group required">
              <label class="col-md-4 control-label" for="boloDescription">Description:</label>
              <div class="col-md-8 col-md-offset-2">
                <textarea id="boloDescription" name="description" rows="4" maxlength="500"
                  placeholder="Description" class="form-control input-md" required></textarea>
              </div>
            </div>

            <!-- Scope toggle: Department or Community -->
            <div class="form-group required">
              <label class="col-md-4 control-label" for="boloScope">Scope:</label>
              <div class="col-md-8">
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="scope" id="scopeCommunity" value="Community" checked required>
                  <label class="form-check-label" for="scopeCommunity">Community</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="scope" id="scopeDepartment" value="Department">
                  <label class="form-check-label" for="scopeDepartment">Department</label>
                </div>
              </div>
            </div>

            <!-- Hidden inputs -->
            <input type="hidden" id="boloCommunityID" name="communityID" value="<%= user.user.activeCommunity %>">
            <input type="hidden" id="boloDepartmentID" name="departmentID" value="<%= departmentId %>">
            <input type="hidden" id="boloReportedByID" name="reportedByID" value="<%= user._id %>">

            <!-- Button -->
            <div class="form-group">
              <label class="col-md-4 control-label" for="createBolo"></label>
              <div class="col-md-4 text-align-center">
                <button id="createBolo" type="submit" class="btn btn-primary">Create</button>
              </div>
            </div>
          </fieldset>
        </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Call Modal -->
<div id="callModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4>Create Call</h4>
          <button class="btn btn-primary btn-md" type="button" data-dismiss="modal" aria-hidden="true">X</button>
        </div>
        <hr style="width: 88%; max-width: 100rem;">
        
        <div id="callForm" class="form-horizontal">
          <!-- Title -->
          <div class="form-group">
            <label class="col-md-4 control-label">Title:</label>
            <div class="col-md-8">
              <input id="callTitle" type="text" class="form-control" placeholder="Enter call title" maxlength="50" required>
            </div>
          </div>

          <!-- Details -->
          <div class="form-group">
            <label class="col-md-4 control-label">Details:</label>
            <div class="col-md-8">
              <textarea id="callDetails" class="form-control" rows="4" placeholder="Enter call details" maxlength="500"></textarea>
            </div>
          </div>

          <!-- Departments -->
          <div class="form-group">
            <label class="col-md-4 control-label">Departments:</label>
            <div class="col-md-8">
              <select id="callDepartments" multiple class="form-control"></select>
            </div>
          </div>

          <!-- Assigned To -->
          <div class="form-group">
            <label class="col-md-4 control-label">Assigned To:</label>
            <div class="col-md-8">
              <select id="callMembers" multiple class="form-control"></select>
            </div>
          </div>

          <!-- Note -->
          <div class="form-group">
            <label class="col-md-4 control-label">Note:</label>
            <div class="col-md-8">
              <textarea id="callNote" class="form-control" rows="3" placeholder="Enter initial note (optional)" maxlength="500"></textarea>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="form-group">
            <div class="col-md-12 d-flex justify-content-between">
              <button class="btn btn-secondary" data-dismiss="modal">Cancel</button>
              <button class="btn btn-primary" onclick="createCall()">Create</button>
            </div>
          </div>

          <input type="hidden" id="communityId" value="<%= user.user.lastAccessedCommunity.communityID %>">
          <input type="hidden" id="createdById" value="<%= user._id %>">
          <input type="hidden" id="createdByUsername" value="<%= user.user.username %> (<%= user.user.callSign %>)">
        </div>
      </div>
    </div>
  </div>
</div>

  <!-- Call Detail Modal -->
<div id="callDetailModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4>Call Details</h4>
          <button class="btn btn-primary btn-md" type="button" data-dismiss="modal" aria-hidden="true">X</button>
        </div>
        <hr style="width: 88%; max-width: 100rem;">
        
        <div id="callDetailForm" class="form-horizontal">
          <!-- Created At -->
          <div class="form-group">
            <label class="col-md-4 control-label">Created At:</label>
            <div class="col-md-8">
              <h5 id="createdAtCallDetail"></h5>
            </div>
          </div>

          <!-- Status -->
          <div class="form-group">
            <label class="col-md-4 control-label">Status:</label>
            <div class="col-md-8">
              <h5 id="statusCallDetail" class="badge badge-primary"></h5>
            </div>
          </div>

          <!-- Title -->
          <div class="form-group">
            <label class="col-md-4 control-label">Title:</label>
            <div class="col-md-8">
              <input id="titleCallDetail" type="text" class="form-control" placeholder="Enter call title" maxlength="50" disabled>
            </div>
          </div>

          <!-- Details -->
          <div class="form-group">
            <label class="col-md-4 control-label">Details:</label>
            <div class="col-md-8">
              <textarea id="detailsCallDetail" class="form-control" rows="4" placeholder="Enter call details" maxlength="500" disabled></textarea>
            </div>
          </div>

          <!-- Departments -->
          <div class="form-group">
            <label class="col-md-4 control-label">Departments:</label>
            <div class="col-md-8">
              <div id="departmentsCallDetail" class="d-flex flex-wrap"></div>
              <select id="departmentsSelect" multiple class="form-control mt-2" style="display: none;"></select>
            </div>
          </div>

          <!-- Assigned To -->
          <div class="form-group">
            <label class="col-md-4 control-label">Assigned To:</label>
            <div class="col-md-8">
              <div id="assignedToCallDetail" class="d-flex flex-wrap"></div>
              <select id="membersSelect" multiple class="form-control mt-2" style="display: none;"></select>
            </div>
          </div>

          <!-- Notes -->
          <div class="form-group">
            <label class="col-md-4 control-label">Notes:</label>
            <div class="col-md-8">
              <div id="notesCallDetail"></div>
              <button id="addNoteBtn" class="btn btn-primary btn-md mt-2" onclick="toggleAddNote()">Add Note</button>
              <div id="addNoteSection" style="display: none;" class="mt-2">
                <textarea id="newNoteInput" class="form-control" rows="3" placeholder="Enter your note..." maxlength="500"></textarea>
                <div class="d-flex justify-content-between mt-2">
                  <button class="btn btn-secondary btn-md" onclick="toggleAddNote()">Cancel</button>
                  <button class="btn btn-primary btn-md" onclick="addNote()">Add Note</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="form-group">
            <div class="col-md-12 d-flex justify-content-between">
              <div>
                <button id="editCallBtn" class="btn btn-primary" onclick="toggleEditMode()">Edit</button>
                <button id="saveCallBtn" class="btn btn-primary" style="display: none;" onclick="saveChanges()">Save</button>
                <button id="cancelEditBtn" class="btn btn-secondary" style="display: none;" onclick="toggleEditMode()">Cancel</button>
              </div>
              <div>
                <button id="deleteCallBtn" class="btn btn-danger" onclick="deleteCall()">Delete</button>
                <button id="closeCallBtn" class="btn btn-success" onclick="markAsCompleted()">Close</button>
                <button id="reopenCallBtn" class="btn btn-warning" style="display: none;" onclick="reopenCall()">Reopen</button>
              </div>
            </div>
          </div>

          <input type="hidden" id="callIDDetail" value="">
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Department Selection Modal -->
<div id="departmentModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4>Select Departments</h4>
          <button class="btn btn-primary btn-md" type="button" data-dismiss="modal" aria-hidden="true">X</button>
        </div>
        <input type="text" id="departmentSearch" class="form-control mb-3" placeholder="Search departments...">
        <div id="departmentList" class="mb-3" style="max-height: 300px; overflow-y: auto;"></div>
        <button class="btn btn-primary btn-block" data-dismiss="modal">Finish</button>
      </div>
    </div>
  </div>
</div>

<!-- Member Selection Modal -->
<div id="memberModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4>Select Members</h4>
          <button class="btn btn-primary btn-md" type="button" data-dismiss="modal" aria-hidden="true">X</button>
        </div>
        <input type="text" id="memberSearch" class="form-control mb-3" placeholder="Search members...">
        <div id="memberList" class="mb-3" style="max-height: 300px; overflow-y: auto;"></div>
        <button class="btn btn-primary btn-block" data-dismiss="modal">Finish</button>
      </div>
    </div>
  </div>
</div>

<!-- Edit Note Modal -->
<div id="editNoteModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" style="z-index: 1100;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4>Edit Note</h4>
          <button class="btn btn-primary btn-md" type="button" data-dismiss="modal" aria-hidden="true">X</button>
        </div>
        <textarea id="editNoteInput" class="form-control" rows="3" maxlength="500" style="resize: vertical;"></textarea>
        <input type="hidden" id="editNoteId">
        <div class="d-flex justify-content-between mt-3">
          <button class="btn btn-secondary btn-md" data-dismiss="modal">Cancel</button>
          <button class="btn btn-primary btn-md" onclick="saveEditedNote()">Save</button>
        </div>
      </div>
    </div>
  </div>
</div>

  <div id="registeredVehicles" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <div class="modal-body">
            <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
              aria-hidden="true">X</button>
            <h2 class="text-center">Registered Vehicles</h2>
            <div class="form-group">
              <div id="registered-cars">
                <div id="registered-cars-loading" class="text-align-center">
                  <div class="lds-facebook"><div></div><div></div><div></div></div>
                </div>
                <div id="issue-loading-registered-cars-alert" style="display:none">
                  <p class="text-center" style="font-style: italic; font-size: 14px">‚ö†Ô∏è Issue loading registered vehicles, try refreshing the page...</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="activeWarrants" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <div class="modal-body">
            <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
              aria-hidden="true">X</button>
            <h2 class="text-center">Active Warrants</h2>
            <div class="form-group">
              <div id="active-warrants">
                <div id="active-warrants-loading" class="text-align-center">
                  <div class="lds-facebook"><div></div><div></div><div></div></div>
                </div>
                <div id="issue-loading-active-warrants-alert" style="display:none">
                  <p class="text-center" style="font-style: italic; font-size: 14px">‚ö†Ô∏è Issue loading warrants, try refreshing the page...</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="registeredFirearms" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <div class="modal-body">
            <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
              aria-hidden="true">X</button>
            <h2 class="text-center">Registered Firearms</h2>
            <div class="form-group">
              <div id="registered-firearms">
                <div id="registered-firearms-loading" class="text-align-center">
                  <div class="lds-facebook"><div></div><div></div><div></div></div>
                </div>
                <div id="issue-loading-registered-firearms-alert" style="display:none">
                  <p class="text-center" style="font-style: italic; font-size: 14px">‚ö†Ô∏è Issue loading firearms, try refreshing the page...</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="nonCommunityBoloModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <div class="modal-body">
            <h2 class="text-center">I'm sorry! üò•</h2>
            <p class="text-center">Looks like you are not in a community yet, so this feature is not enabled.
            </p>
            <p>To join or
              create a community for free, click on the communities button in the Left Menu.</p>
            <p>Or just click here: <a data-toggle="modal" href="#communitiesModal">Communities</a>
            </p>
            <br />
            <button class="btn btn-primary btn-lg center-block" data-dismiss="modal" aria-hidden="true">OK <i
                class="ion-android-close"></i></button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="confirmClearBoloModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <form id="bolo-clear-form" class="form-horizontal" action="/clear-bolo" method="POST">
            <fieldset>

              <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
                aria-hidden="true">X</button>
              <h4>Clear Bolo?</h4>
              <hr style="width: 88%;max-width: 100rem;">

              <p id="bolo-reason"></p>
              <input id="bolo-clear-date" type="hidden" name="updatedAt" value="">
              <input id="bolo-clearingOfficerID" type="hidden" name="clearingOfficerID" value=<%=user._id%>>
              <input id="bolo-clearingOfficerUsername" type="hidden" name="clearingOfficerUsername"
                value="<%= user.user.username%> (<%= user.user.callSign %>)">
              <input id="bolo-ID" type="hidden" name="boloID" value="">

              <!-- Button -->
              <div class="form-group">
                <label class="col-md-4 control-label" for="submit-bolo-clear-creation"></label>
                <div class="col-md-4">
                  <input type="hidden" name="route" value="dispatch-dashboard">
                  <button id="submit-bolo-clear-creation" class="btn btn-success">Yes</button>
                  <button class="btn btn-danger" data-dismiss="modal">No</button>
                </div>
              </div>
            </fieldset>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div id="communitiesModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          
        </div>
      </div>
    </div>
  </div>

  <div id="joinCommunityModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <form class="form-horizontal" action="/joinPoliceCommunity" method="post">
            <fieldset>

              <!-- Form Name -->
              <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
                aria-hidden="true">X</button>
              <h4>Join an Existing Community</h4>
              <hr style="width: 88%;max-width: 100rem;">

              <!-- Text input-->
              <div class="form-group">
                <label class="col-md-4 control-label" for="communityCode">Community Code:</label>
                <div class="col-md-4">
                  <input id="communityCode" name="communityCode" style="text-transform: uppercase;" type="text"
                    placeholder="Example: YRFGHHP" class="form-control input-md" minlength="7" maxlength="7" required>
                </div>
              </div>

              <!-- Button -->
              <div class="form-group">
                <label class="col-md-4 control-label" for="joinCommunity"></label>
                <div class="col-md-4 text-align-center">
                  <input type="hidden" name="route" value="dispatch-dashboard">
                  <button id="joinCommunity" value="<%= user._id %>" name="userID" class="btn btn-primary">Join</button>
                </div>
              </div>
            </fieldset>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div id="leaveActiveCommunityModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <form class="form-horizontal" action="/leavePoliceActiveCommunity" method="post">
            <fieldset>

              <!-- Form Name -->
              <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
                aria-hidden="true">X</button>
              <h4>Leave Active Community</h4>
              <hr style="width: 88%;max-width: 100rem;">

              <p>NOTE: All civilians and vehicles that were created in this community will no longer
                show up when searching after you leave.
              </p>
              <p>Are you sure you want to leave this community?</p>

              <!-- Button -->
              <div class="form-group">
                <label class="col-md-4 control-label" for="leaveActiveCommunity"></label>
                <div class="col-md-4 text-align-center">
                  <input type="hidden" name="route" value="dispatch-dashboard">
                  <button id="leaveActiveCommunity" value="<%= user._id %>" name="userID"
                    class="btn btn-danger">Leave</button>
                </div>
              </div>
            </fieldset>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div id="createCommunityModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <form class="form-horizontal" action="/createPoliceCommunity" method="post">
            <fieldset>

              <!-- Form Name -->
              <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
                aria-hidden="true">X</button>
              <h4>Create a New Community</h4>
              <hr style="width: 88%;max-width: 100rem;">

              <!-- Text input-->
              <div class="form-group">
                <label class="col-md-4 control-label" for="communityName">Community Name:</label>
                <div class="col-md-4">
                  <input id="communityName" name="communityName" style="text-transform: capitalize;" type="text"
                    placeholder="Community Name" class="form-control input-md" maxlength="25" required>
                </div>
              </div>

              <!-- Button -->
              <div class="form-group">
                <label class="col-md-4 control-label" for="createCommunity"></label>
                <div class="col-md-4 text-align-center">
                  <input type="hidden" name="route" value="dispatch-dashboard">
                  <button id="createCommunity" value="<%= user._id %>" name="userID"
                    class="btn btn-primary">Create</button>
                </div>
              </div>
            </fieldset>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div id="communitiesInfoModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <fieldset>
            <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
              aria-hidden="true">X</button>
            <h4>Check out the New Communities Section!</h4>
            <hr style="width: 88%;max-width: 100rem;">
            <a data-toggle="modal" href="#communitiesModal" onclick="dismissCommunitiesInfoModal()"><img
                src="/images/communities-example.png" class="diagonal-arrow float-right"
                alt="communities example screenshot"></a>
            <img src="/static/images/diagonal-arrow-white.png" class="diagonal-arrow"
              alt="diagonal arrow pointing to top right of page">
          </fieldset>
        </div>
      </div>
    </div>
  </div>

  <% include account-management %>

    <div id="manageUserDispatchStatusModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-body">
            <!-- Modal Name -->
            <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
              aria-hidden="true">X</button>
            <h4>Manage User Status</h4>
            <hr style="width: 88%;max-width: 100rem;">
            <div class="form-horizontal">
              <fieldset>
                <div class="form-group">
                  <label class="col-md-4 control-label" for="accountUsername">Username:</label>
                  <div class="col-md-6">
                    <h5 id="usernameDispatch" style="text-transform: capitalize;"></h5>
                  </div>
                </div>

                <div class="form-group">
                  <label class="col-md-4 control-label" for="accountUsername">Active Status:</label>
                  <div class="col-md-6">
                    <h5 id="statusDispatch"></h5>
                  </div>
                </div>

                <div class="form-group">
                  <label class="col-md-4 control-label" for="accountUsername">Set By:</label>
                  <div class="col-md-6">
                    <h5 id="setByDispatch" style="text-transform: capitalize;"></h5>
                  </div>
                </div>
                <hr style="width: 88%;max-width: 100rem;">
                <input id="userIDDispatch" type="hidden" name="userID" value="">
                <div class="col-md-12 text-align-center margin-bottom-1">
                  <button type="submit" name="status" value="10-8" class="btn btn-primary margin-bottom-1"
                    title="In Service" onclick="updateStatus('10-8')">10-8</button>
                  <button type="submit" name="status" value="10-6" class="btn btn-primary margin-bottom-1" title="Busy"
                    onclick="updateStatus('10-6')">10-6</button>
                  <button type="submit" name="status" value="10-7" class="btn btn-primary margin-bottom-1"
                    title="Out of Service" onclick="updateStatus('10-7')">10-7</button>
                  <button type="submit" name="status" value="10-11" class="btn btn-primary margin-bottom-1"
                    title="Traffic Stop" onclick="updateStatus('10-11')">10-11</button>
                  <button type="submit" name="status" value="10-23" class="btn btn-primary margin-bottom-1"
                    title="Arrived on Scene" onclick="updateStatus('10-23')">10-23</button>
                  <button type="submit" name="status" value="10-97" class="btn btn-primary margin-bottom-1"
                    title="In Route" onclick="updateStatus('10-97')">10-97</button>
                  <button type="submit" name="status" value="10-15" class="btn btn-primary margin-bottom-1"
                    title="Subject in Custody" onclick="updateStatus('10-15')">10-15</button>
                  <button type="submit" name="status" value="10-70" class="btn btn-primary margin-bottom-1"
                    title="Foot Pursuit" onclick="updateStatus('10-70')">10-70</button>
                  <button type="submit" name="status" value="10-80" class="btn btn-primary margin-bottom-1"
                    title="Vehicle Pursuit" onclick="updateStatus('10-80')">10-80</button>
                </div>
                <div class="col-md-12 text-align-center">
                  <button type="submit" name="status" value="10-42" class="btn btn-warning btn-md"
                    title="Log out of CAD" onclick="updateStatus('10-42')">10-42</button>
                  <button type="submit" name="status" value="10-41" class="btn btn-success btn-md" title="Log in to CAD"
                    onclick="updateStatus('10-41')">10-41</button>
                </div>
              </fieldset>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="manageEmsDispatchStatusModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-body">
            <!-- Modal Name -->
            <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
              aria-hidden="true">X</button>
            <h4>Manage User Status</h4>
            <hr style="width: 88%;max-width: 100rem;">
            <div class="form-horizontal">
              <fieldset>
                <div class="form-group">
                  <label class="col-md-4 control-label" for="accountUsername">Engine #:</label>
                  <div class="col-md-6">
                    <h5 id="engineNumberDispatch" style="text-transform: capitalize;"></h5>
                  </div>
                </div>

                <div class="form-group">
                  <label class="col-md-4 control-label" for="accountUsername">Active Status:</label>
                  <div class="col-md-6">
                    <h5 id="emsStatusDispatch"></h5>
                  </div>
                </div>

                <div class="form-group">
                  <label class="col-md-4 control-label" for="accountUsername">Set By:</label>
                  <div class="col-md-6">
                    <h5 id="emsSetByDispatch" style="text-transform: capitalize;"></h5>
                  </div>
                </div>
                <hr style="width: 88%;max-width: 100rem;">
                <input id="vehicleIDDispatch" type="hidden" name="vehicleID" value="">
                <div class="col-md-12 text-align-center margin-bottom-1">
                  <button type="submit" name="status" value="10-8" class="btn btn-primary margin-bottom-1"
                    title="In Service" onclick="updateEmsStatus('10-8')">10-8</button>
                  <button type="submit" name="status" value="10-6" class="btn btn-primary margin-bottom-1" title="Busy"
                    onclick="updateEmsStatus('10-6')">10-6</button>
                  <button type="submit" name="status" value="10-7" class="btn btn-primary margin-bottom-1"
                    title="Out of Service" onclick="updateEmsStatus('10-7')">10-7</button>
                  <button type="submit" name="status" value="10-23" class="btn btn-primary margin-bottom-1"
                    title="Arrived on Scene" onclick="updateEmsStatus('10-23')">10-23</button>
                  <button type="submit" name="status" value="10-97" class="btn btn-primary margin-bottom-1"
                    title="In Route" onclick="updateEmsStatus('10-97')">10-97</button>
                </div>
                <div class="col-md-12 text-align-center">
                  <button type="submit" name="status" value="10-42" class="btn btn-warning btn-md"
                    title="Log out of CAD" onclick="updateEmsStatus('10-42')">10-42</button>
                  <button type="submit" name="status" value="10-41" class="btn btn-success btn-md" title="Log in to CAD"
                    onclick="updateEmsStatus('10-41')">10-41</button>
                </div>
              </fieldset>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="panicDetailModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-body">
            <form id="clear-panic-form" class="form-horizontal" action="" method="post">
              <fieldset>

                <!-- Form Name -->
                <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
                  aria-hidden="true">X</button>
                <h4>Clear Panic</h4>
                <hr style="width: 88%;max-width: 100rem;">

                <!-- Button -->
                <div class="form-group">
                  <label class="col-md-4 control-label" for="deleteAccount"></label>
                  <div class="col-md-4 text-align-center">
                    <input id="panic-id" type="hidden" name="panic-id" value="">
                    <button id="clearPanic" class="btn btn-danger"
                      onclick="hideModal('panicDetailModal')">Clear</button>
                  </div>
                </div>
              </fieldset>
            </form>
          </div>
        </div>
      </div>
    </div>

    

    

    <div id="officerHelpModal" class="modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <span class="modal-title" style="font-size: 18px;">Officer List Help</span>
            <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
              aria-hidden="true">X</button>
          </div>
          <div class="modal-footer text-align-center">
            <p>If you see no records in the table, that means no officers have marked themselves 10-41 or "on-duty".</p><p> Remind
              your officers to make sure and mark themselves 10-41 when they go "on-duty" and 10-42 when they go "off-duty".
            </p>
          </div>
        </div>
      </div>
    </div>

    <div id="fireEMSHelpModal" class="modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <span class="modal-title" style="font-size: 18px;">Fire/EMS List Help</span>
            <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
              aria-hidden="true">X</button>
          </div>
          <div class="modal-footer text-align-left">
            <p>If you see no records in the table, that means there are no active Vehicles created in your community.</p><p> Remind
              your Fire/EMS personnel to either create a new Vehicle or make sure it is not marked as'offline'.
            </p>
          </div>
        </div>
      </div>
    </div>

    <div id="assignedFireEmsHelpModal" class="modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <span class="modal-title" style="font-size: 18px;">Fire/EMS Assigned List Help</span>
            <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
              aria-hidden="true">X</button>
          </div>
          <div class="modal-footer text-align-left">
            <p>If you see no records in the dropdown, that means there are no active Vehicles with Personnel assigned in your community.</p>
            <p> Remind
              your Fire/EMS personnel to either create a new Vehicle or make sure it is not marked as 'offline', and then assign that vehicle to a Personnel.
            </p>
          </div>
        </div>
      </div>
    </div>

    <% include notification-modal %>
    <% include 10-codes %>
    <% include notepad %>
</body>

<!--scripts loaded here -->
<script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
<script src="/socket.io/socket.io.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/jquery.easing.min.js"></script>
<script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.21/js/dataTables.bootstrap.min.js"></script>
<script src="/static/js/wow.js"></script>
<script src="/static/js/popper.js"></script>
<script src="/static/js/main.js"></script>
<script src="/static/js/name-database.js"></script>
<script src="/static/js/plate-database.js"></script>
<script src="/static/js/dispatch-dashboard.js"></script>
<script src="/static/js/departments.js"></script>
<script src="/static/js/search-database.js"></script>
<script src="/static/js/details-modal.js"></script>
<script src="/static/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.0/jquery.cookie.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
<script src="/static/js/scripts.js"></script>
<script>if (window.module) module = window.module;</script>
<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

</html>
<script>
  $(function () {
    var socket=io();
    socket.on('updated_ems_status', res => {
      if (res.onDuty&&res.updateDuty) {
        //socket coming in that a ems engine is going on-duty
        $('#'+res.vehicleID+"-duty").removeClass('hide')
        $('#'+res.vehicleID+"-duty").attr('style', 'cursor: pointer')
      } else if (!res.onDuty&&res.updateDuty) {
        //socket coming in that a ems engine is going off-duty
        $('#'+res.vehicleID+"-duty").attr('style', 'background-color: #d9534f !important')
        $('#'+res.vehicleID+"-duty").addClass('hide')
      }
      $('#'+res.vehicleID+"-status").text(res.status)

      repopulateFireEmsList(res.vehicleID, res.status)
    });

    // socket.on('updated_status', res => {
    //   if (res.onDuty&&res.updateDuty) {
    //     //socket coming in that a user is going on-duty
    //     $('#'+res.userID+"-duty").removeClass('hide')
    //     $('#'+res.userID+"-duty").attr('style', 'cursor: pointer')
    //   } else if (!res.onDuty&&res.updateDuty) {
    //     //socket coming in that a user is going off-duty
    //     $('#'+res.userID+"-duty").attr('style', 'background-color: #d9534f !important')
    //     $('#'+res.userID+"-duty").addClass('hide')
    //   }
    //   if (res.status=="Panic") {
    //     $('#'+res.userID+"-status").text("üö® "+res.status+" üö®")
    //   } else {
    //     $('#'+res.userID+"-status").text(res.status)
    //   }

    //   repopulateOfficerList(res.userID, res.status)
    // })

    socket.on('load_panic_status_update', (map, signal100Resp, holdTrafficResp, origReq) => {
      if (dbUser.user.activeCommunity==origReq.activeCommunity) {
        //load the signal 100 status to the page
        if (signal100Resp) {
          $('#signal-100-banner').removeClass('hide').addClass('show')
        } else {
          $('#signal-100-banner').removeClass('show').addClass('hide')
        }
        if (holdTrafficResp) {
          $('#hold-traffic-banner').removeClass('hide').addClass('show')
        } else {
          $('#hold-traffic-banner').removeClass('show').addClass('hide')
        }

        //load the panic status items
        $('#panic-placeholder-socket').empty();
        $('#panic-placeholder').append(
          '<div id="panic-placeholder-socket"></div>'
        ).fadeTo(1, function () {
          $(this).add();
        })
        for (var m in map) {
          $('#panic-placeholder-socket').append(
            '<a id="'+map[m].userId+'-panic-row" data-toggle="modal" href="#panicDetailModal" onclick="populatePanicDetails(\''+map[m].userId+'\')">'+
            '<div class="alert alert-danger alert-dismissible show" role="alert">'+
            '<strong>Panic! </strong> Triggered by: <span id="'+map[m].userId+'-panic-username">'+map[m].username+'</span>'+
            '<button type="button" type="button" class="close" aria-label="Close">'+
            '<span aria-hidden="true">&times;</span>'+
            '</button>'+
            '</div>'+
            '</a>'
          ).fadeTo(1, function () {
            $(this).add();
          })
        }
      }
    })

    socket.on('panic_button_updated', (map, origReq) => {
      if (dbUser.user.activeCommunity==origReq.activeCommunity) {
        if ($('#panic-button-check-sound').prop('checked')) {
          var audioElement=document.createElement('audio');
          audioElement.setAttribute('src', '/static/audio/Police_panic_button_sound_adj.mp3');
          audioElement.volume = dbUser.user.alertVolumeLevel/100 || 0.1;
          audioElement.play();
        }
        $('#panic-placeholder-socket').empty();
        $('#panic-placeholder').append(
          '<div id="panic-placeholder-socket"></div>'
        ).fadeTo(1, function () {
          $(this).add();
        })
        for (var m in map) {
          $('#panic-placeholder-socket').append(
            '<a id="'+map[m].userId+'-panic-row" data-toggle="modal" href="#panicDetailModal" onclick="populatePanicDetails(\''+map[m].userId+'\')">'+
            '<div class="alert alert-danger alert-dismissible show" role="alert">'+
            '<strong>Panic! </strong> Triggered by: <span id="'+map[m].userId+'-panic-username">'+map[m].username+'</span>'+
            '<button type="button" type="button" class="close" aria-label="Close">'+
            '<span aria-hidden="true">&times;</span>'+
            '</button>'+
            '</div>'+
            '</a>'
          ).fadeTo(1, function () {
            $(this).add();
          })
        }
      }
    })

    socket.on('cleared_panic', res => {
      $('#'+res.userID+'-panic-row').remove().fadeOut(1, function () {
        $(this).remove();
      })
    })

    socket.on('signal_100_button_updated', (origReq) => {
      if (dbUser.user.activeCommunity==origReq.activeCommunity) {
        if ($('#panic-button-check-sound').prop('checked')) {
          var audioElement=document.createElement('audio');
          audioElement.setAttribute('src', '/static/audio/Dispatch_signal_100_beep_adj.mp3');
          audioElement.volume = dbUser.user.alertVolumeLevel/100 || 0.1;
          audioElement.play();
        }
        $('#signal-100-banner').removeClass('hide').addClass('show')
      }
    })

    socket.on('hold_traffic_button_updated', (origReq) => {
      if (dbUser.user.activeCommunity==origReq.activeCommunity) {
        if ($('#panic-button-check-sound').prop('checked')) {
          var audioElement=document.createElement('audio');
          audioElement.setAttribute('src', '/static/audio/Hold_traffic_sound_adj.mp3');
          audioElement.volume = dbUser.user.alertVolumeLevel/100 || 0.1;
          audioElement.play();
        }
        $('#hold-traffic-banner').removeClass('hide').addClass('show')
      }
    })

    socket.on('clear_signal_100_updated', activeCommunity => {
      if (dbUser.user.activeCommunity==activeCommunity) {
        $('#signal-100-banner').removeClass('show').addClass('hide')
      }
    })

    socket.on('clear_hold_traffic_updated', activeCommunity => {
      if (dbUser.user.activeCommunity==activeCommunity) {
        $('#hold-traffic-banner').removeClass('show').addClass('hide')
      }
    })

    socket.on('updated_bolo', res => {
      $('#'+res.boloID+"-type").text(res.boloType)
      $('#'+res.boloID+"-location").text(res.location)
      $('#'+res.boloID+"-description").text(res.description)
    })

    socket.on('deleted_bolo', res => {
      $('#'+res.boloID+'-row').remove().fadeOut(1, function () {
        $(this).remove();
      })
    })

    // socket.on('created_bolo', res => {
    //   if (res.bolo.communityID==dbUser.user.activeCommunity) {
    //     var containsEmptyRow=$('#boloTable tr>td').hasClass('dataTables_empty');
    //     if (containsEmptyRow) {
    //       $('#boloTable tbody>tr:first').fadeOut(1, function () {
    //         $(this).remove();
    //       })
    //     }
    //     $('#boloTable tr:last').after(
    //       `<tr id="`+res._id+`-row" class="gray-hover" data-toggle="modal" data-target="#boloDetailModal" onclick="populateBoloDetails('`+res._id+`')">`+
    //       '<td id="'+res._id+'-type" style="text-transform: capitalize;">'+res.bolo.boloType+'</td>'+
    //       '<td id="'+res._id+'-location">'+res.bolo.location+'</td>'+
    //       '<td id="'+res._id+'-description">'+res.bolo.description+'</td>'+
    //       '</tr>').fadeTo(1, function () {
    //         $(this).add();
    //       })
    //   }
    // })

    // socket.on('created_call', res => {
    //   if (res.call.communityID==dbUser.user.activeCommunity) {
    //     var containsEmptyRow=$('#callTable tr>td').hasClass('dataTables_empty');
    //     if (containsEmptyRow) {
    //       $('#callTable tbody>tr:first').fadeOut(1, function () {
    //         $(this).remove();
    //       })
    //     }
    //     var assignedUnits=""
    //     if (res.call.assignedOfficers != undefined && res.call.assignedOfficers != null) {
    //       if (res.call.assignedOfficers!=null&&res.call.assignedOfficers.length>0) {
    //         for (var j=0; j<res.call.assignedOfficers.length; j++) {
    //           if (dbCommUsers != undefined && dbCommUsers != null) {
    //             for (var k=0; k<dbCommUsers.length; k++) {
    //               if (dbCommUsers[k]._id==res.call.assignedOfficers[j]) {
    //                 if (dbCommUsers[k].user.callSign==undefined) {
    //                   dbCommUsers[k].user.callSign=""
    //                 }
    //                 assignedUnits+='<span class="badge badge-secondary">'+dbCommUsers[k].user.username+' ('+dbCommUsers[k].user.callSign+')'+'</span> '
    //               }
    //             }
    //           }
    //         }
    //       }
    //     }
    //     if (res.call.assignedFireEms != undefined && res.call.assignedFireEms != null) {
    //       if (res.call.assignedFireEms != null && res.call.assignedFireEms.length> 0) {
    //         for(let j=0; j<res.call.assignedFireEms.length; j++) {
    //           if (dbEmsVehicles != undefined && dbEmsVehicles != null) {
    //             for(let k=0; k<dbEmsVehicles.length; k++) {
    //               if (dbEmsVehicles[k]._id==res.call.assignedFireEms[j]) {
    //                 assignedUnits+=`<span class="badge badge-secondary">Engine #${dbEmsVehicles[k].emsVehicle.engineNumber} | (${dbEmsVehicles[k].emsVehicle.model})</span>`
    //               }
    //             }
    //           }
    //         }
    //       }
    //     }
    //     if (assignedUnits === "") {
    //       assignedUnits='<span class="badge badge-secondary">N/A</span>'
    //     }

    //     $('#callTable tr:last').after(
    //       `<tr id="${res._id}-row" class="gray-hover" data-toggle="modal" data-target="#callDetailModal" onclick="populateCallDetails('${res._id}');populateOfficerList('${res.call.assignedOfficers}');populateFireEmsList('${res.call.assignedFireEms}');populateClassifierList('${res.call.classifier}')">`+
    //       `<td id="${res._id}-createdAt" style="text-transform: capitalize;">${res.call.createdAtReadable}</td>`+
    //       `<td id="${res._id}-description">${res.call.shortDescription}</td>`+
    //       `<td id="${res._id}-units-assigned">${assignedUnits}</td>`+
    //       `</tr>`).fadeTo(1, function () {
    //         $(this).add();
    //       })
    //   }
    // })
  });
</script>
<script type="text/javascript">

  // Router variables should be used over allocating per use
  var dbUser= <%- JSON.stringify(user)%>;
  var departmentId = <%- JSON.stringify(departmentId) %>;

  var page = 0;
  var pageVeh = 0;
  var pageGun = 0;
  var pageLicense = 0;
  var civFirstName = "";
  var civLastName = "";
  const API_URL = "https://police-cad-app-api-bc6d659b60b3.herokuapp.com";
  let currentBoloPage = 0;
  const boloLimit = 10;

  $.delete=function (url, data, callback, type) {
    if ($.isFunction(data)) {
      type=type||callback,
        callback=data,
        data={}
    }

    return $.ajax({
      url: url,
      type: 'DELETE',
      success: callback,
      data: data,
      contentType: type
    });
  }

  $(document).ready(function () {
    // $('#officerListTable').DataTable({
    //   "bLengthChange": false,
    //   "pageLength": 5,
    //   columnDefs: [
    //     { type: 'title-numeric', targets: 0 }
    //   ]
    // });

    // $('#fireEmsListTable').DataTable({
    //   "bLengthChange": false,
    //   "pageLength": 5,
    //   columnDefs: [
    //     { type: 'title-numeric', targets: 0 }
    //   ]
    // });

    //load the officer list table, we do this because we want to filter out any
    //officers that are not currently on duty. DataTables is easier to leverage
    //than relying on the html above
  //   if (dbUser.user.activeCommunity !== '' && dbUser.user.activeCommunity !== undefined){
  //     if (dbCommUsers != null && dbCommUsers != undefined) {
  //       let datatable = $('#officerListTable').DataTable();
  //           datatable.clear();
  //           dbCommUsers.forEach(val => {
  //             officerTable = ""
  //             if (!val.user.dispatchOnDuty) {
  //               return;
  //             }
  //             if (val.user.username == undefined) {
  //               val.user.username = ""
  //             }
  //             if (val.user.callSign == undefined) {
  //               val.user.callSign = ""
  //             }
  //             if (val.user.dispatchStatus == undefined ||val.user.dispatchStatus == '') {
  //               val.user.dispatchStatus = "-" //set a default
  //             } else if (val.user.dispatchStatus == 'Panic') {
  //               val.user.dispatchStatus = "üö® Panic üö®" //set a custom panic message
  //             }

  //             officerTable += `<tr id="${val._id}-duty" class="gray-hover" data-toggle="modal"data-target="#manageUserDispatchStatusModal"onclick="setDispatchModalValues('${val._id}')">
  //               <td style="text-transform: capitalize;">
  //                 ${val.user.username}
  //               </td>
  //               <td style="text-transform: capitalize;">
  //                 ${val.user.callSign}
  //               </td>
  //               <td id="${val._id}-status">
  //                 ${val.user.dispatchStatus}
  //               </td>
  //             </tr>`
  //           datatable.row.add($(officerTable))
  //           })
  //           datatable.draw();
  //     }
  //     if (dbEmsVehicles != null && dbEmsVehicles != undefined) {
  //       let emsDataTable = $('#fireEmsListTable').DataTable();
  //         emsDataTable.clear();
          
  //         dbEmsVehicles.forEach(val => {
  //           emsTable = ""
  //           if (val.emsVehicle.engineNumber == undefined) {
  //             val.emsVehicle.engineNumber = ""
  //           }
  //           if (val.emsVehicle.model == undefined) {
  //             val.emsVehicle.model = ""
  //           }
  //           if (val.emsVehicle.dispatchStatus == undefined ||val.emsVehicle.dispatchStatus == '') {
  //             val.emsVehicle.dispatchStatus = "-" //set a default
  //           }

  //           emsTable += `
  //             <tr id="${val._id}-duty" class="gray-hover" data-toggle="modal"data-target="#manageEmsDispatchStatusModal"onclick="setEmsDispatchModalValues('${val._id}')">
  //             <td style="text-transform: capitalize;">
  //               #${val.emsVehicle.engineNumber}
  //             </td>
  //             <td style="text-transform: capitalize;">
  //               ${val.emsVehicle.model}
  //             </td>
  //             <td id="${val._id}-status">
  //               ${val.emsVehicle.dispatchStatus}
  //             </td>
  //           </tr>`
  //         emsDataTable.row.add($(emsTable))
  //         });
  //         emsDataTable.draw();

  //       $('#boloTable').DataTable({
  //         "bLengthChange": false,
  //         "pageLength": 5,
  //       });

  //       $('#callTable').DataTable({
  //         "bLengthChange": false,
  //         "pageLength": 5,
  //       });
  //   }
  // }

    if (($(window).height()+100)<$(document).height()) {
      $('#top-link-block').removeClass('hidden').affix({
        // how far to scroll down before link "slides" into view
        offset: { top: 100 }
      });
    }

    // displays the Update Username and Cancel buttons for updating the username
    $('#accountUsername').on('keyup', function (e) {
      if (e.target.value!=dbUser.user.username&&e.target.value!='') {
        $('#updateUsernameBtns').show();
      } else {
        $('#updateUsernameBtns').hide();
      }
    })

    $('#accountCallSign').on('keyup', function (e) {
      if (e.target.value!=dbUser.user.callSign&&e.target.value!='') {
        $('#updateCallSignBtns').show();
      } else {
        $('#updateCallSignBtns').hide();
      }
    })

    $('#panic-button-check-sound').prop("checked", dbUser.user.panicButtonSound)
    $('#alert-volume-slider').val(dbUser.user.alertVolumeLevel || 10)

    
    // if (dbVehicles!=null) {
    //   $('#plateDetails').show()
    //   $('#plateDatabaseModal').modal('toggle');
    //   searchPlate()
    // } else if (dbCivilians!=null) {
    //   $('#civDetails').show()
    //   $('#nameDatabaseModal').modal('toggle');
    //   searchNames()
    //   populateDriversLicense(dbCivilians)
    // } else if (dbFirearms!=null) {
    //   $('#firearmDetails').show()
    //   $('#firearmDatabaseModal').modal('toggle');
    //   searchFirearm()
    // } else {
    //   $('#plateDetails').removeAttr("style").hide()
    //   $('#civDetails').removeAttr("style").hide()
    //   $('#firearmDetails').removeAttr("style").hide()
    // }

    $("#civ-first-name").keydown(function (event) {
      if (event.keyCode==32) {
        event.preventDefault();
        $('#civ-first-name').popover('show')
      } else {
        $('#civ-first-name').popover('hide')
      }
    });

    $("#civ-last-name").keydown(function (event) {
      if (event.keyCode==32) {
        event.preventDefault();
        $('#civ-last-name').popover('show')
      } else {
        $('#civ-last-name').popover('hide')
      }
    });

    $('#warning-select').change(function () {
      if ($('#warning-option-other').is(':selected')) {
        $('#warning-other-div').show();
      }
    })

    $('#warrant-select').change(function () {
      if ($('#warrant-other-option').is(':selected')) {
        $('#warrant-other-div').show();
      }
    })

    $('#ticket-select').change(function (e) {
      if ($('#ticket-option-other').is(':selected')) {
        $('#ticket-other-div').show();
      }

      var selected=$(e.target).val();
      let total=0
      selected.forEach(val => {
        let subVal=val.substring(2)
        total+=parseInt(subVal)
      })
      $('#amount').val(parseInt(total))
    })

    $("#submitTicket").on('click', function () {
      $('#crimeList').val($("#ticket-select").find("option:selected").text())
    });

    $("#submitWarning").on('click', function () {
      $('#warningCrimeList').val($("#warning-select").find("option:selected").text())
    });

    //CURRENT_VERSION
    //the current version in production
    let CURRENT_VERSION = "v3.1.0"
    let MINOR_VERSION = CURRENT_VERSION.split(".")[1]

    //check for notification cookie
    let cookieVersion = undefined
    let cookieValueSplit = document.cookie.split('; ')
    if (cookieValueSplit != undefined && cookieValueSplit != null) {
      if (cookieValueSplit.length > 0) {
        let cookieValueNotifSymbol = cookieValueSplit.find(row => row.startsWith('notification-symbol='))
        if (cookieValueNotifSymbol != undefined && cookieValueNotifSymbol != null) {
          let cookieVersionSplit = cookieValueNotifSymbol.split('=');
          if (cookieVersionSplit != null && cookieVersionSplit != undefined) {
            if (cookieVersionSplit.length > 1) {
              cookieVersion = cookieVersionSplit[1];
            }
          }
        }
      }
    }

    // if we cannot find the cookie, then we will set it to be 1
    if (cookieVersion === undefined) {
      $('#notification-count').text(1)
    } else if (cookieVersion == CURRENT_VERSION) {
      // else if cookie version is equal to current version, then we dont set anything :mark-all-as-read:
      $('#notification-symbol').removeClass('notif')
      $('#notification-count').text('')
    } else {
      // else if we can find the cookie, then we will subtract whatever the cookie value is from the current version
      let specificVersionSplit = cookieVersion.split(".")
      if (specificVersionSplit != null && specificVersionSplit != undefined) {
        if (specificVersionSplit.length == 3) {
          let versionDifference = Math.abs(parseInt(MINOR_VERSION) - parseInt(specificVersionSplit[1]))
          $('#notification-count').text(versionDifference)
        }
      }
    }

    //load gravatar image
  var MD5 = function(d){var r = M(V(Y(X(d),8*d.length)));return r.toLowerCase()};function M(d){for(var _,m="0123456789ABCDEF",f="",r=0;r<d.length;r++)_=d.charCodeAt(r),f+=m.charAt(_>>>4&15)+m.charAt(15&_);return f}function X(d){for(var _=Array(d.length>>2),m=0;m<_.length;m++)_[m]=0;for(m=0;m<8*d.length;m+=8)_[m>>5]|=(255&d.charCodeAt(m/8))<<m%32;return _}function V(d){for(var _="",m=0;m<32*d.length;m+=8)_+=String.fromCharCode(d[m>>5]>>>m%32&255);return _}function Y(d,_){d[_>>5]|=128<<_%32,d[14+(_+64>>>9<<4)]=_;for(var m=1732584193,f=-271733879,r=-1732584194,i=271733878,n=0;n<d.length;n+=16){var h=m,t=f,g=r,e=i;f=md5_ii(f=md5_ii(f=md5_ii(f=md5_ii(f=md5_hh(f=md5_hh(f=md5_hh(f=md5_hh(f=md5_gg(f=md5_gg(f=md5_gg(f=md5_gg(f=md5_ff(f=md5_ff(f=md5_ff(f=md5_ff(f,r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+0],7,-680876936),f,r,d[n+1],12,-389564586),m,f,d[n+2],17,606105819),i,m,d[n+3],22,-1044525330),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+4],7,-176418897),f,r,d[n+5],12,1200080426),m,f,d[n+6],17,-1473231341),i,m,d[n+7],22,-45705983),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+8],7,1770035416),f,r,d[n+9],12,-1958414417),m,f,d[n+10],17,-42063),i,m,d[n+11],22,-1990404162),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+12],7,1804603682),f,r,d[n+13],12,-40341101),m,f,d[n+14],17,-1502002290),i,m,d[n+15],22,1236535329),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+1],5,-165796510),f,r,d[n+6],9,-1069501632),m,f,d[n+11],14,643717713),i,m,d[n+0],20,-373897302),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+5],5,-701558691),f,r,d[n+10],9,38016083),m,f,d[n+15],14,-660478335),i,m,d[n+4],20,-405537848),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+9],5,568446438),f,r,d[n+14],9,-1019803690),m,f,d[n+3],14,-187363961),i,m,d[n+8],20,1163531501),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+13],5,-1444681467),f,r,d[n+2],9,-51403784),m,f,d[n+7],14,1735328473),i,m,d[n+12],20,-1926607734),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+5],4,-378558),f,r,d[n+8],11,-2022574463),m,f,d[n+11],16,1839030562),i,m,d[n+14],23,-35309556),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+1],4,-1530992060),f,r,d[n+4],11,1272893353),m,f,d[n+7],16,-155497632),i,m,d[n+10],23,-1094730640),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+13],4,681279174),f,r,d[n+0],11,-358537222),m,f,d[n+3],16,-722521979),i,m,d[n+6],23,76029189),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+9],4,-640364487),f,r,d[n+12],11,-421815835),m,f,d[n+15],16,530742520),i,m,d[n+2],23,-995338651),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+0],6,-198630844),f,r,d[n+7],10,1126891415),m,f,d[n+14],15,-1416354905),i,m,d[n+5],21,-57434055),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+12],6,1700485571),f,r,d[n+3],10,-1894986606),m,f,d[n+10],15,-1051523),i,m,d[n+1],21,-2054922799),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+8],6,1873313359),f,r,d[n+15],10,-30611744),m,f,d[n+6],15,-1560198380),i,m,d[n+13],21,1309151649),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+4],6,-145523070),f,r,d[n+11],10,-1120210379),m,f,d[n+2],15,718787259),i,m,d[n+9],21,-343485551),m=safe_add(m,h),f=safe_add(f,t),r=safe_add(r,g),i=safe_add(i,e)}return Array(m,f,r,i)}function md5_cmn(d,_,m,f,r,i){return safe_add(bit_rol(safe_add(safe_add(_,d),safe_add(f,i)),r),m)}function md5_ff(d,_,m,f,r,i,n){return md5_cmn(_&m|~_&f,d,_,r,i,n)}function md5_gg(d,_,m,f,r,i,n){return md5_cmn(_&f|m&~f,d,_,r,i,n)}function md5_hh(d,_,m,f,r,i,n){return md5_cmn(_^m^f,d,_,r,i,n)}function md5_ii(d,_,m,f,r,i,n){return md5_cmn(m^(_|~f),d,_,r,i,n)}function safe_add(d,_){var m=(65535&d)+(65535&_);return(d>>16)+(_>>16)+(m>>16)<<16|65535&m}function bit_rol(d,_){return d<<_|d>>>32-_}
  let hash = MD5(dbUser.user.email.trim().toLowerCase())
  $('.profile-picture').css("background-image", `url(https://www.gravatar.com/avatar/${hash}?s=200)`)

  }); /* End of document.ready */

  document.addEventListener("DOMContentLoaded", function () {
    tail.select(".select-move", {
      search: true,
      descriptions: true,
      hideSelected: false,
      hideDisabled: true,
      multiShowCount: false,
      multiContainer: true
    });
  });

  window.onload=function () {
    if (dbUser.user.activeCommunity!=null&&dbUser.user.activeCommunity!=undefined) {
      var socket=io();
      var myReq={
        userID: dbUser._id,
        userUsername: dbUser.user.username,
        activeCommunity: dbUser.user.activeCommunity
      }
      socket.emit('load_panic_statuses', myReq)
    }
  }

  // AJAX function to load active BOLOs
  // Needs to be inside of this file so it can access the departmentId variable
  function loadActiveBOLOs() {
    const communityId = dbUser.user.lastAccessedCommunity.communityID;
    if (!communityId) {
      console.warn("No community ID found, skipping BOLO load.");
      return;
    }

    $.ajax({
      url: `${API_URL}/api/v1/bolos?communityId=${communityId}&departmentId=${departmentId}&limit=${boloLimit}&page=${currentBoloPage}&status=true`,
      method: "GET",
      success: function (response) {
        const $tbody = $("#boloTable tbody");
        $tbody.empty(); // Clear existing rows
        const bolos = response.data || [];
        const totalCount = response.totalCount || bolos.length; // Fallback if totalCount is missing

        if (bolos.length === 0) {
          $tbody.append(
            '<tr><td colspan="3" class="text-center">No BOLOs found.</td></tr>'
          );
        } else {
          bolos.forEach((bolo) => {
            const boloId = bolo._id;
            $tbody.append(`
              <tr class="gray-hover" data-toggle="modal" data-id="${boloId}" data-target="#boloDetailModal" onclick="populateBoloDetails('${boloId}')">
                <td style="text-transform: capitalize;">${
                  bolo.bolo?.title || "N/A"
                }</td>
                <td>${bolo.bolo?.location || "N/A"}</td>
                <td>${bolo.bolo?.description || "N/A"}</td>
              </tr>
            `);
          });
        }

        // Add pagination controls
        const $pagination = $("#boloTable").next(".bolo-pagination");
        if ($pagination.length === 0) {
          $("#boloTable").after(
            '<div class="bolo-pagination d-flex justify-content-between mt-2"></div>'
          );
        }
        const $paginationContainer = $(".bolo-pagination");
        $paginationContainer.empty();
        if (totalCount > boloLimit) {
          $paginationContainer.append(`
            <button class="btn btn-primary" onclick="changeBoloPage(${
              currentBoloPage - 1
            })" ${currentBoloPage === 1 ? "disabled" : ""}>Previous</button>
            <button class="btn btn-primary" onclick="changeBoloPage(${
              currentBoloPage + 1
            })" ${
            currentBoloPage * boloLimit >= totalCount ? "disabled" : ""
          }>Next</button>
          `);
        }
        
      },
      error: function (xhr) {
        console.error("Error loading BOLOs:", xhr.responseText);
        $("#boloTable tbody")
          .empty()
          .append(
            '<tr><td colspan="3" class="text-center">Error loading BOLOs.</td></tr>'
          );
      },
    });
  }

  function getRegisteredFirearms(registeredOwnerID, index) {
    //remove any existing panel body on button click
    $('.reg-arm').remove();
    $(`#registered-firearms`).show()
    $('#registered-firearms-loading').show()
    $('#issue-loading-registered-firearms-alert').hide()

    var socket=io();

    myReq={
      regOwnerID: registeredOwnerID,
      communityID: dbUser.user.activeCommunity
    }
    socket.emit('get_reg_arm', myReq)
    socket.on('load_reg_arm_result', res => {
      if (res != undefined && res != null) {
        if (res.length==0) {
          $('#registered-firearms').append(
            `<div id="registered-firearms-panel-body-${index}" class="panel-body reg-arm">`+
            `<h5 style="text-align: center;">No Registered Firearms</h5>`+
            `</div>`
          )
          $('#registered-firearms-loading').hide();
          return
        }
        $('#registered-firearms').append(
          `<div id="registered-firearms-panel-body-${index}" class="panel-body reg-arm">`
        )
        for (i=0; i<res.length; i++) {
          if (i!=0) { //if we are not on the first loop, add a divider between each record
            $('#registered-firearms-panel-body-'+index).append(
              '<hr>'
            )
          }
          // Check if firearm is stolen and append result
          if (res[i].firearm.isStolen=="true") {
            $('#registered-firearms-panel-body-'+index).append(
              `<div id="stolenMessage" class="alert alert-danger" style="display:block">`+
              `<strong>Danger!</strong> #${res[i].firearm.serialNumber} reported as stolen.`+
              `</div>`
            )
          }
          $('#registered-firearms-panel-body-'+index).append(
            `Serial #: ${res[i].firearm.serialNumber}<br/>`+
            `Weapon Type: ${res[i].firearm.weaponType}<br/>`
          )
        }
      } else {
        $('#issue-loading-registered-firearms-alert').show()
      }
      $('#registered-firearms-loading').hide();
    });
  }

  function getRegisteredCars(registeredOwner, index, registeredOwnerID) {
    //remove any existing panel body on button click
    $('.reg-car').remove();
    $(`#registered-cars`).show()
    $('#registered-cars-loading').show()
    $('#issue-loading-registered-cars-alert').hide()
    var socket=io();

    myReq={
      regOwner: registeredOwner,
      regOwnerID: registeredOwnerID, //new ID established 1/30/2021 so will only work on vehicles after this date
      communityID: dbUser.user.activeCommunity
    }
    socket.emit('get_reg_veh', myReq)
    socket.on('load_reg_veh_result', res => {
      if (res != null && res != undefined) {
        if (res.length==0) {
          $('#registered-cars').append(
            `<div id="registered-cars-panel-body-${index}" class="panel-body reg-car">`+
            `<h5 style="text-align: center;">No Registered Vehicles</h5>`+
            `</div>`
          )
          $('#registered-cars-loading').hide();
          return
        }
        $('#registered-cars').append(
          `<div id="registered-cars-panel-body-${index}" class="panel-body reg-car">`
        )
        for (i=0; i<res.length; i++) {

          if (i!=0) { //if we are not on the first loop, add a divider between each record
            $('#registered-cars-panel-body-'+index).append(
              `<hr>`
            )
          }
          //check if vehicle is stolen and append result
          if (res[i].vehicle.isStolen==2) {
            $('#registered-cars-panel-body-'+index).append(
              `<div id="stolenMessage" class="alert alert-danger" style="display:block">`+
              `<strong>Danger!</strong> Vehicle reported as stolen.`+
              `</div>`
            )
          }
          $('#registered-cars-panel-body-'+index).append(
            `Vin #: ${res[i].vehicle.vin}<br/>`+
            `License Plate #: ${res[i].vehicle.plate}<br/>`+
            `Color: ${res[i].vehicle.color}<br/>`+
            `Model: ${res[i].vehicle.model}<br/>`
          )
          //check for valid/invalid insurance and append result
          if (res[i].vehicle.validInsurance==1) {
            $('#registered-cars-panel-body-'+index).append(
              `<p class="plate-body-text">Insurance: Valid <i class="ion-checkmark-circled color-green"></i></p>`
            )
          } else {
            $('#registered-cars-panel-body-'+index).append(
              `<p class="plate-body-text">Insurance: Invalid <i class="ion-alert-circled color-red"></i></p>`
            )
          }
          //check for valid/invalid registration and append result
          if (res[i].vehicle.validRegistration==1) {
            $('#registered-cars-panel-body-'+index).append(
              `<p class="plate-body-text">Registration: Valid <i class="ion-checkmark-circled color-green"></i></p>`
            )
          } else {
            $('#registered-cars-panel-body-'+index).append(
              `<p class="plate-body-text">Registration: Invalid <i class="ion-alert-circled color-red"></i></p>`
            )
          }
        }
      } else {
        $('#issue-loading-registered-cars-alert').show()
      }
      $('#registered-cars-loading').hide();
    })
  }

  function getActiveWarrants(index, accusedID) {
    //remove any existing panel body on button click
    $('.active-reg').remove();
    $(`#active-warrants`).show()
    $('#active-warrants-loading').show()
    $('#issue-loading-active-warrants-alert').hide()

    var socket=io();

    myReq={
      accusedID: accusedID,
    }
    socket.emit('get_active_warrants', myReq)
    socket.on('load_active_warrants_result', res => {
      if (res != undefined && res != null) {
        $('#active-warrants').append(
          `<div id="active-warrants-panel-body-${index}" class="panel-body active-reg">`
        )
        let counter = 0
        for (i=0; i<res.length; i++) {
          //check if warrant is active and append result
          if (res[i].warrant.status) {
            if (i!=0) { //if we are not on the first loop, add a divider between each record
            $('#active-warrants-panel-body-'+index).append(
              `<hr>`
            )
          }
            $('#active-warrants-panel-body-'+index).append(
              `<div id="stolenMessage" class="alert alert-danger" style="display:block">`+
              `<strong>Danger!</strong> Active Warrant.`+
              `</div>`
            )
            $('#active-warrants-panel-body-'+index).append(
            `Date Created: ${res[i].warrant.date}<br/>`+
            `Time Created: ${res[i].warrant.time}<br/>`+
            `Reporting Officer: ${res[i].warrant.reportingOfficer}<br/>`+
            `Reason(s): ${res[i].warrant.reasons}<br/>`
          )

          $('#active-warrants-panel-body-'+index).append(
            `<button type="button" class="btn btn-info margin-bottom-05" id="confirmWarrantModal" data-toggle="modal" href="#confirmClearWarrantModal" onclick="clearWarrantWithValues('${res[i]._id}', '${res[i].warrant.reasons}')">Clear</button>`
          )
          counter++
          }
        }
        if (counter === 0) {
          $('#active-warrants').append(
            `<div id="active-warrants-panel-body-${index}" class="panel-body active-reg">`+
            `<h5 style="text-align: center;">No Active Warrants</h5>`+
            `</div>`
          )
        }
      } else {
        $('#issue-loading-active-warrants-alert').show()
      }
      $('#active-warrants-loading').hide();
    })
  }


  // function searchPlate() {
  //   let x=document.getElementById('plateDetails');
  //   if (x.style.display==='none') {
  //     x.style.display='block';
  //   } else { }

  //   if (dbVehicles===null || dbVehicles == undefined) {
  //     return
  //   }
  //   if (dbVehicles.length===0) {
  //     $('#plateDetails').removeAttr("style").hide()
  //     $('#vehicleNotFound').show()
  //     return
  //   }
  // }

  // function searchFirearm() {
  //   let x=document.getElementById('firearmDetails');
  //   if (x.style.display==='none') {
  //     x.style.display='block';
  //   } else { }

  //   if (dbFirearms===null || dbFirearms == undefined) {
  //     return
  //   }
  //   if (dbFirearms.length===0) {
  //     $('#firearmDetails').removeAttr("style").hide()
  //     $('#firearmNotFound').show()
  //     return
  //   }
  // }

  // function searchNames() {
  //   let x=document.getElementById('civDetails');
  //   if (x.style.display==='none') {
  //     x.style.display='block';
  //   } else { }
  //   if (dbCivilians===null || dbCivilians == undefined) {
  //     hideCivPopover();
  //     return
  //   } else if (dbCivilians.length===0) {
  //     let civDetails=document.getElementById('civDetails')
  //     civDetails.style.display='none'
  //     let civNotFoundMsg=document.getElementById('civilianNotFound')
  //     civNotFoundMsg.style.display='block'
  //     hideCivPopover();
  //     return
  //   }
  //   hideCivPopover();
  // }

  function openSearch() {
    $('#searchTicketDiv').show()
  }

  function setDateAndTime(dateElement, timeElement) {
    $(dateElement)[0].valueAsDate=new Date();
    $(timeElement)[0].value=new Date().toLocaleTimeString('en-GB', {
      hour: "2-digit",
      minute: "2-digit"
    })
  }

  function generateCaseNo(elementName) {
    $(elementName).val(Math.round(Math.random()*10000000000))
  }

  function hideTicketCivPopover() {
    if ($('#civID').val().length<1) {
      $('#civID').popover('show')
      $('#ticket-form').attr('onsubmit', 'return false;');
    } else {
      $('#civID').popover('hide')
      $('#ticket-form').attr('onsubmit', 'return true;');
    }
  }

  function hideWarningCivPopover() {
    if ($('#civIDWarning').val().length<1) {
      $('#civIDWarning').popover('show')
      $('#warning-form').attr('onsubmit', 'return false;');
    } else {
      $('#civIDWarning').popover('hide')
      $('#warning-form').attr('onsubmit', 'return true;');
    }
  }

  function hideArrestReportPopover() {
    if ($('#civIDArrest').val().length<1) {
      $('#civIDArrest').popover('show')
      $('#arrest-form').attr('onsubmit', 'return false;');
    } else {
      $('#civIDArrest').popover('hide')
      $('#arrest-form').attr('onsubmit', 'return true;');
    }
  }

  function hideCivPopover() {
    $('#civ-first-name').popover('hide')
    $('#civ-last-name').popover('hide')
  }

  function hideWarrantClearPopover() {
    $('#confirmWarrantModal').hide()
  }

  function OpenClearWarrant(firstName, lastName, id, dob) {
    $('#warrant-clear-civ-first-name').val(firstName)
    $('#warrant-clear-civ-last-name').val(lastName)
    $('#civIDWarrantClear').val(id)
    $('#warrant-clear-civ-dob').val(dob)
    $('#searchWarrantClearDiv').hide()
  }

  function OpenCreateWarrant(firstName, lastName, id, dob) {
    $('#warrant-civ-first-name').val(firstName)
    $('#warrant-civ-last-name').val(lastName)
    $('#civIDWarrant').val(id)
    //Super gross date calculation, thx javascript
    let date=new Date()
    let yyyy=date.getFullYear().toString();
    let mm=(date.getMonth()+1).toString(); // getMonth() is zero-based
    let dd=date.getDate().toString();
    $('#warrant-date').val(yyyy+'-'+(mm[1]? mm:"0"+mm[0])+'-'+(dd[1]? dd:"0"+dd[0]))
    $('#warrant-time').val(new Date().toLocaleTimeString('en-GB', {
      hour: "2-digit",
      minute: "2-digit"
    }))
    $('#warrant-civ-dob').val(dob)
    $('#searchWarrantDiv').hide()
  }

  // function clearWarrantWithValues(warrantID, warrantReason) {
  //   $('#warrant-ID').val(warrantID)
  //   $('#warrant-reason').text(warrantReason)
  //   //Super gross date calculation, thx javascript
  //   let date=new Date()
  //   let yyyy=date.getFullYear().toString();
  //   let mm=(date.getMonth()+1).toString(); // getMonth() is zero-based
  //   let dd=date.getDate().toString();
  //   $('#warrant-clear-date').val(yyyy+'-'+(mm[1]? mm:"0"+mm[0])+'-'+(dd[1]? dd:"0"+dd[0]))
  //   $('#warrant-clear-time').val(new Date().toLocaleTimeString('en-GB', {
  //     hour: "2-digit",
  //     minute: "2-digit"
  //   }))
  // }

  function clearBolo(boloID) {
    $('#bolo-ID').val(boloID)
    $('#bolo-clear-date').val(new Date())
  }

  function fillAccountDetails() {
    $('#accountEmail').val(dbUser.user.email)
    $('#accountUsername').val(dbUser.user.username)
    $('#accountCallSign').val(dbUser.user.callSign)
  }

  function cancelUsername() {
    $('#accountUsername').val(dbUser.user.username)
    $('#updateUsernameBtns').hide();
  }

  function cancelCallSign() {
    $('#accountCallSign').val(dbUser.user.callSign)
    $('#updateCallSignBtns').hide();
  }

  function populateBoloDetails(id) {
    var socket=io();
    socket.emit('load_dispatch_bolos', dbUser)
    socket.on('load_dispatch_bolos_result', (res) => {
      for (const i in res) {
        if (res[i]._id!=id) {
          continue
        } else if (res[i]._id==id) {
          $('#boloTypeDetail').val(res[i].bolo.boloType)
          $('#locationDetail').val(res[i].bolo.location)
          $('#descriptionDetail').val(res[i].bolo.description)
          $('#boloIDDetail').val(res[i]._id)
          $('#createdByDetail').text(res[i].bolo.reportingOfficerUsername)
          var createdDate=new Date(res[i].bolo.createdAt)
          $('#createdAtDetail').text(createdDate.toLocaleString())
          if (res[i].bolo.updatedAt==null||res[i].bolo.updatedAt=='') {
            $('#updatedAtDetail').text('')
          } else {
            var updatedDate=new Date(res[i].bolo.updatedAt)
            $('#updatedAtDetail').text(updatedDate.toLocaleString())
          }
        } else {
          //IDK we have issues
        }
      }
    })
  }

  function populateCallDetails(id) {
    var socket=io();
    socket.emit('load_dispatch_calls', dbUser)
    socket.on('load_dispatch_calls_result', (res) => {
      for (const i in res) {
        if (res[i]._id!=id) {
          continue
        } else if (res[i]._id==id) {
          $('#descriptionCallDetail').val(res[i].call.shortDescription)
          $('#callNotesDetail').val(res[i].call.callNotes)
          $('#callIDDetail').val(res[i]._id)
          $('#callIDDetailDeleteClose').val(res[i]._id)
          var createdDate=new Date(res[i].call.createdAt)
          $('#createdAtCallDetail').text(createdDate.toLocaleString())
          if (res[i].call.updatedAt==null||res[i].call.updatedAt=='') {
            $('#updatedAtCallDetail').text('N/A')
          } else {
            var updatedDate=new Date(res[i].call.updatedAt)
            $('#updatedAtCallDetail').text(updatedDate.toLocaleString())
          }
        } else {
          //IDK we have issues
        }
      }
    })
  }

  function setDispatchModalValues(id) {
    var socket=io();
    socket.emit('load_statuses', dbUser)
    socket.on('load_status_result', (res) => {
      for (const i in res) {
        if (res[i]._id!=id) {
          continue
        } else if (res[i]._id==id) {
          $('#usernameDispatch').text(res[i].user.username)
          if (res[i].user.dispatchStatus==""||res[i].user.dispatchStatus==undefined) {
            $('#statusDispatch').text("-")
          } else {
            $('#statusDispatch').text(res[i].user.dispatchStatus)
          }
          if (res[i].user.dispatchStatusSetBy==""||res[i].user.dispatchStatusSetBy==undefined) {
            $('#setByDispatch').text("-")
          } else {
            $('#setByDispatch').text(res[i].user.dispatchStatusSetBy)
          }
          $('#userIDDispatch').val(res[i]._id)
        } else {
          //IDK we have issues
        }
      }
    })
  }

  function setEmsDispatchModalValues(id) {
    var socket=io();
    if (dbEmsVehicles != null && dbEmsVehicles != undefined) {
      for (let i=0; i<dbEmsVehicles.length; i++) {
        if (dbEmsVehicles[i]._id==id) {
          socket.emit('load_ems_statuses', dbEmsVehicles[i])
          socket.on('load_ems_status_result', (res) => {
            for (const i in res) {
              if (res[i]._id==id) {
                $('#engineNumberDispatch').text(res[i].emsVehicle.engineNumber)
                if (res[i].emsVehicle.dispatchStatus==""||res[i].emsVehicle.dispatchStatus==undefined) {
                  $('#emsStatusDispatch').text("-")
                } else {
                  $('#emsStatusDispatch').text(res[i].emsVehicle.dispatchStatus)
                }
                if (res[i].emsVehicle.dispatchStatusSetBy==""||res[i].emsVehicle.dispatchStatusSetBy==undefined) {
                  $('#emsSetByDispatch').text("-")
                } else {
                  $('#emsSetByDispatch').text(res[i].emsVehicle.dispatchStatusSetBy)
                }
                $('#vehicleIDDispatch').val(res[i]._id)
              } else continue
            }
          })
        }
      }
    }
  }

  $('#updateBolo').one('click', function () {
    var val=$(this).attr('value')
    var socket=io();
    $('#update-bolo-form').submit(function (e) {
      e.preventDefault(); //prevents page from reloading

      if (val=='update') {
        var myReq={
          action: 'update',
          boloID: $('#boloIDDetail').val(),
          boloType: $('#boloTypeDetail').val(),
          location: $('#locationDetail').val(),
          description: $('#descriptionDetail').val()
        }
        socket.emit('update_bolo_info', myReq)
      }
      return true;
    })
  })

  $('#deleteBolo').one('click', function () {
    var val=$(this).attr('value')
    // location.assign('/dispatch-dashboard')
    var socket=io();
    $('#delete-bolo-form').submit(function (e) {
      e.preventDefault(); //prevents page from reloading

      if (val=='delete') {
        var myReq={
          action: 'delete',
          boloID: $('#boloIDDetail').val(),
          boloType: $('#boloTypeDetail').val(),
          location: $('#locationDetail').val(),
          description: $('#descriptionDetail').val()
        }
        socket.emit('delete_bolo_info', myReq)
      }

      return true;
    })
    $('#boloDetailModal').modal('hide')
  })

  function clearSignal100() {
    var socket=io();
      socket.emit('clear_signal_100', dbUser.user.activeCommunity)
    $('#signal-100-banner').removeClass('show').addClass('hide')
  }

  function clearHoldTraffic() {
    var socket=io();
      socket.emit('clear_hold_traffic', dbUser.user.activeCommunity)
    $('#hold-traffic-banner').removeClass('show').addClass('hide')
  }

  $('#createBolo').one('click', function () {
    var socket=io();
      $('#create-bolo-form').submit(function (e) {
        e.preventDefault(); //prevents page from reloading
        var myCreateReq={
          boloType: $('#type option:selected').text(),
          location: $('#location').val(),
          communityID: dbUser.user.activeCommunity,
          description: $('#description').val(),
          reportingOfficerUsername: dbUser.user.username,
          reportingOfficerID: dbUser._id
        }
        socket.emit('create_bolo', myCreateReq)
        return true;
      })
    $('#boloModal').modal('hide')
  })

  $('#createCall').one('click', function () {
    var socket=io();
      $('#create-call-form').submit(function (e) {
        e.preventDefault(); //prevents page from reloading
        myCreatedAt=new Date();
        myCreatedDate=new Date(myCreatedAt);

        var myCreateReq={
          classifier: $('#classifier').val(),
          shortDescription: $('#short-description').val(),
          assignedOfficers: $('#officer-select').val(),
          assignedFireEms: $('#fireEms-select').val(),
          callNotes: $('#call-notes').val(),
          createdByUsername: dbUser.user.username,
          createdByID: dbUser._id,
          communityID: dbUser.user.activeCommunity,
          createdAt: myCreatedAt,
          createdAtReadable: myCreatedDate.toLocaleString()
        }
        socket.emit('create_call', myCreateReq)
        return true;
      })
    $('#callModal').modal('hide');
  })

  $('#closeCall').click(function () {
    var socket=io();
    var myReq={
      callID: $('#callIDDetail').val(),
      communityID: dbUser.user.activeCommunity,
    }
    socket.emit('clear_call', myReq)
  })

  $('#deleteCall').click(function () {
    var socket=io();
    var myReq={
      callID: $('#callIDDetail').val(),
      communityID: dbUser.user.activeCommunity,
    }
    socket.emit('clear_call', myReq);
  })

  function updateEmsStatus(status) {
    var socket=io();
    var onDuty=null
    var updateDuty=false
    if (status=='10-41') {
      onDuty=true
      updateDuty=true
      status="Online"
    } else if (status=='10-42') {
      onDuty=false
      updateDuty=true
      status="Offline"
    }
    myReq={
      vehicleID: $('#vehicleIDDispatch').val(),
      status: status,
      setBy: 'Dispatch',
      onDuty: onDuty,
      updateDuty: updateDuty
    }
    socket.emit('update_ems_status', myReq)

    $('#manageEmsDispatchStatusModal').modal('hide')
  }

  function updateStatus(status) {
    var socket=io();
    var onDuty=null
    var updateDuty=false
    if (status=='10-41') {
      onDuty=true
      updateDuty=true
      status="Online"
    } else if (status=='10-42') {
      onDuty=false
      updateDuty=true
      status="Offline"
    }
    myReq={
      userID: $('#userIDDispatch').val(),
      status: status,
      setBy: 'Dispatch',
      onDuty: onDuty,
      updateDuty: updateDuty
    }
    socket.emit('update_status', myReq)

    $('#manageUserDispatchStatusModal').modal('hide')
  }

  $('#clearPanic').one('click', function () {
    var socket=io();
    $('#clear-panic-form').submit(function (e) {
      e.preventDefault(); //prevents page from reloading
      var myReq={
        userID: $('#panic-id').val(),
        communityID: dbUser.user.activeCommunity
      }
      socket.emit('clear_panic', myReq)
      panicButtonEnabled=true

      var myUpdateReq={
        userID: $('#panic-id').val(),
        status: '10-8',
        setBy: 'System',
        onDuty: null,
        updateDuty: false
      }
      socket.emit('update_status', myUpdateReq)
      return true;
    })
    $('#panicDetailModal').modal('hide')
  })

  function populatePanicDetails(id) {
    $('#panic-id').val(id)
  }

  //Clears bolo form on button press because we are using sockets
  function clearBoloForm() {
    document.getElementById("create-bolo-form").reset();
  }

  //Clears call form on button press because we are using sockets
  function clearCallForm() {
    document.getElementById("create-call-form").reset();
  }

  function repopulateFireEmsList(id, status) {
    
    //override the values stored in memory, with the ones we just got back from the socket
    if (dbEmsVehicles != null && dbEmsVehicles != undefined) {
      for (i=0; i<dbEmsVehicles.length; i++) {
        if (dbEmsVehicles[i]._id==id) {
          dbEmsVehicles[i].emsVehicle.dispatchStatus=status
        }
      }
      var engineListNewCall=tail.select('#fireEms-select', {
        search: true,
        classNames: "default white",
        descriptions: true,
        sortGroups: "ASC",
        sortItems: "ASC",
        placeholder: "Fire/Ems Engine List",
        multiPinSelected: true,
        hideSelected: false,
        hideDisabled: true,
        multiShowCount: false,
        multiContainer: true
      })
      var newCallItems={}
      for (i=0; i<dbEmsVehicles.length; i++) {
        if (!dbEmsVehicles[i].emsVehicle.engineNumber) {
          dbEmsVehicles[i].emsVehicle.engineNumber=""
        }
        newCallItems[dbEmsVehicles[i]._id]={
          value: 'Engine - '+dbEmsVehicles[i].emsVehicle.engineNumber+' ( '+dbEmsVehicles[i].emsVehicle.model+' )',
          group: "#",
          selected: false,
          disabled: false,
          description: dbEmsVehicles[i].emsVehicle.registeredOwner
        }
      }
      engineListNewCall.options.add(newCallItems)
    }
  }

  // function repopulateOfficerList(id, status) {
  //   //override the values stored in memory, with the ones we just got back from the socket
  //   if (dbCommUsers != undefined && dbCommUsers != null) {
  //     for (i=0; i<dbCommUsers.length; i++) {
  //       if (dbCommUsers[i]._id==id) {
  //         dbCommUsers[i].user.dispatchStatus=status
  //       }
  //     }

  //     //List containing all officers when creating a new call
  //     var officerListNewCall=tail.select('#officer-select', {
  //       search: true,
  //       classNames: "default white",
  //       descriptions: true,
  //       sortGroups: "ASC",
  //       sortItems: "ASC",
  //       placeholder: "Officer List",
  //       multiPinSelected: true,
  //       hideSelected: false,
  //       hideDisabled: true,
  //       multiShowCount: false,
  //       multiContainer: true
  //     })
  //     var newCallItems={}
  //     for (i=0; i<dbCommUsers.length; i++) {
  //       //To be deprecated once all users have set a call sign, going into effect 11/25/2020
  //       if (!dbCommUsers[i].user.callSign) {
  //         dbCommUsers[i].user.callSign=""
  //       }
  //       newCallItems[dbCommUsers[i]._id]={
  //         value: dbCommUsers[i].user.username+' ('+dbCommUsers[i].user.callSign+')',
  //         group: "#",
  //         selected: false,
  //         disabled: false,
  //         description: dbCommUsers[i].user.dispatchStatus
  //       }
  //     }
  //     officerListNewCall.options.add(newCallItems)
  //   }
  // }

  function fillClassifierList() {
    var classifierList=tail.select('#classifier', {
      search: false,
      classNames: "default white",
      descriptions: false,
      sortGroups: "ACS",
      sortItems: "ACS",
      placeholder: "Department(s)",
      multiPinSelected: true,
      hideSelected: false,
      hideDisabled: true,
      multiShowCount: false,
      multiContainer: true
    })
    var items = {}
    items["Police"]={
      value: "Police",
      group: "#",
      selected: false,
      disabled: false
    }
    items["Fire"]={
      value: "Fire",
      group: "#",
      selected: false,
      disabled: false
    }
    items["EMS"]={
      value: "EMS",
      group: "#",
      selected: false,
      disabled: false
    }
    classifierList.options.add(items)
  }

  function fillFireEmsList() {
    var engineList=tail.select('#fireEms-select', {
      search: true,
      classNames: "default white",
      descriptions: true,
      sortGroups: "ASC",
      sortItems: "ASC",
      placeholder: "Fire/Ems Engine List",
      multiPinSelected: true,
      hideSelected: false,
      hideDisabled: true,
      multiShowCount: false,
      multiContainer: true
    })
    var items={}
    if (dbEmsVehicles != null && dbEmsVehicles != undefined) {
      for (i=0; i<dbEmsVehicles.length; i++) {
        if (!dbEmsVehicles[i].emsVehicle.engineNumber) {
          dbEmsVehicles[i].emsVehicle.engineNumber=""
        }
        items[dbEmsVehicles[i]._id]={
          value: 'Engine - '+dbEmsVehicles[i].emsVehicle.engineNumber+' ( '+dbEmsVehicles[i].emsVehicle.model+' )',
          group: "#",
          selected: false,
          disabled: false,
          description: dbEmsVehicles[i].emsVehicle.registeredOwner
        }
      }
      engineList.options.add(items)
    }
  }

  // function fillOfficerList() {
  //   var officerList=tail.select('#officer-select', {
  //     search: true,
  //     classNames: "default white",
  //     descriptions: true,
  //     sortGroups: "ASC",
  //     sortItems: "ASC",
  //     placeholder: "Officer List",
  //     multiPinSelected: true,
  //     hideSelected: false,
  //     hideDisabled: true,
  //     multiShowCount: false,
  //     multiContainer: true
  //   })
  //   if (dbCommUsers != undefined && dbCommUsers != null) {
  //     var items={}
  //     for (i=0; i<dbCommUsers.length; i++) {
  //       //To be deprecated once all users have set a call sign, going into effect 11/25/2020
  //       if (!dbCommUsers[i].user.callSign) {
  //         dbCommUsers[i].user.callSign=""
  //       }
  //       items[dbCommUsers[i]._id]={
  //         value: dbCommUsers[i].user.username+' ('+dbCommUsers[i].user.callSign+')',
  //         group: "#",
  //         selected: false,
  //         disabled: false,
  //         description: dbCommUsers[i].user.dispatchStatus
  //       }
  //     }
  //     officerList.options.add(items)
  //   }
  // }

  function populateClassifierList(classifiers) {
    let classifierDb = ['Police','Fire','EMS']
    var classifierList = tail.select('#classifier-details', {
      search: false,
      classNames: "default white",
      descriptions: true,
      sortGroups: "ASC",
      sortItems: "ASC",
      placeholder: "Classifier List",
      multiPinSelected: true,
      hideSelected: false,
      hideDisabled: true,
      multiShowCount: false,
      multiContainer: true
    }).reload()
    let items={}
    
    if (classifiers != undefined && classifiers != null) {
      // If there are none assigned
      if (classifiers.length==0) {
        for (i=0; i<classifierDb.length; i++) {
          items[i]={
            value: classifierDb[i],
            group: "#",
            selected: false,
            disabled: false,
            description: null
          }
        }
      } else if (classifiers.includes(0) || classifiers.includes(1) || classifiers.includes(2)) {
        classifierSplit = classifiers.split(",")
        for (i=0; i < classifierDb.length; i++) {
          if (classifiers.includes(i)) {
            items[classifierDb[i]]={
                    value: classifierDb[i],
                    group: "#",
                    selected: true,
                    disabled: false,
                    description: null
                  }
          } else {
            items[classifierDb[i]]={
                    value: classifierDb[i],
                    group: "#",
                    selected: false,
                    disabled: false,
                    description: null
                  }
          }
        }
      } else if (classifiers.length > 0) {
        classifierSplit = classifiers.split(",")
          if (classifierDb != undefined && classifierDb != null) {
            for (i=0; i<classifierDb.length; i++) {
              for (j=0; j<classifiers.length; j++) {
                if (classifierDb[i] == classifierSplit[j]) {
                  items[classifierDb[i]]={
                    value: classifierDb[i],
                    group: "#",
                    selected: true,
                    disabled: false,
                    description: null
                  }
                  break
                } else {
                  items[classifierDb[i]]={
                    value: classifierDb[i],
                    group: "#",
                    selected: false,
                    disabled: false,
                    description: null
                  }
                }
              }
            }
          }
      }
      classifierList.options.add(items);
    }
  }

  function populateFireEmsList(dbFireEms) {
    var emsList = tail.select('#fireEms-select-details', {
      search: true,
      classNames: "default white",
      descriptions: true,
      sortGroups: "ASC",
      sortItems: "ASC",
      placeholder: "Fire/EMS List",
      multiPinSelected: true,
      hideSelected: false,
      hideDisabled: true,
      multiShowCount: false,
      multiContainer: true
    }).reload();

    if (dbFireEms != null && dbFireEms != undefined) {
      if (dbEmsVehicles != null && dbEmsVehicles != undefined) {
        let items={}

        // If there are none assigned
        if (dbFireEms.length==0) {
          for (i=0; i<dbEmsVehicles.length; i++) {
            if (!dbEmsVehicles[i].emsVehicle.engineNumber) {
              dbEmsVehicles[i].emsVehicle.engineNumber=""
            }
            items[dbEmsVehicles[i]._id]={
              value: 'Engine - '+dbEmsVehicles[i].emsVehicle.engineNumber+' ( '+dbEmsVehicles[i].emsVehicle.model+' )',
              group: "#",
              selected: false,
              disabled: false,
              description: dbEmsVehicles[i].emsVehicle.registeredOwner
            }
          }
        } else {
          emsSplit = dbFireEms.split(",")
          for (i=0; i<dbEmsVehicles.length; i++) {
            for (j=0; j<dbFireEms.length; j++) {
              if (dbEmsVehicles[i]._id == emsSplit[j]) {
                if (!dbEmsVehicles[i].emsVehicle.engineNumber) {
                  dbEmsVehicles[i].emsVehicle.engineNumber=""
                }
                items[dbEmsVehicles[i]._id]={
                  value: 'Engine - '+dbEmsVehicles[i].emsVehicle.engineNumber+' ( '+dbEmsVehicles[i].emsVehicle.model+' )',
                  group: "#",
                  selected: true,
                  disabled: false,
                  description: dbEmsVehicles[i].emsVehicle.registeredOwner
                }
                break
              } else {
                if (!dbEmsVehicles[i].emsVehicle.engineNumber) {
                  dbEmsVehicles[i].emsVehicle.engineNumber=""
                }
                items[dbEmsVehicles[i]._id]={
                  value: 'Engine - '+dbEmsVehicles[i].emsVehicle.engineNumber+' ( '+dbEmsVehicles[i].emsVehicle.model+' )',
                  group: "#",
                  selected: false,
                  disabled: false,
                  description: dbEmsVehicles[i].emsVehicle.registeredOwner
                }
              }
            }
          }
        }
        emsList.options.add(items)
      }
    }
  }

  // Param: dbOfficers, contains a list of IDs of the active officers assigned to the call
  // Example: 5edeeaa078cf272b2ce9e40e,5ee00e3adde8ab0344ea49a2
  // function populateOfficerList(dbOfficers) {
  //   var officerList=tail.select('#officer-select-details', {
  //     search: true,
  //     classNames: "default white",
  //     descriptions: true,
  //     sortGroups: "ASC",
  //     sortItems: "ASC",
  //     placeholder: "Officer List",
  //     multiPinSelected: true,
  //     hideSelected: false,
  //     hideDisabled: true,
  //     multiShowCount: false,
  //     multiContainer: true
  //   }).reload();
  //   var items={}

  //   if (dbOfficers != undefined && dbOfficers != null) {
  //     if (dbCommUsers != undefined && dbCommUsers != null) {
  //       // if there are none assigned
  //       if (dbOfficers.length==0) {
  //         for (i=0; i<dbCommUsers.length; i++) {
  //           //To be deprecated once all users have set a call sign, going into effect 11/25/2020
  //           if (!dbCommUsers[i].user.callSign) {
  //             dbCommUsers[i].user.callSign=""
  //           }
  //           items[dbCommUsers[i]._id]={
  //             value: dbCommUsers[i].user.username+' ('+dbCommUsers[i].user.callSign+')',
  //             group: "#",
  //             selected: false,
  //             disabled: false,
  //             description: dbCommUsers[i].user.dispatchStatus
  //           }
  //         }
  //       } else {
  //         officersSplit=dbOfficers.split(",")
  //         for (i=0; i<dbCommUsers.length; i++) {
  //           for (j=0; j<dbOfficers.length; j++) {
  //             if (dbCommUsers[i]._id==officersSplit[j]) {
  //               //To be deprecated once all users have set a call sign, going into effect 11/25/2020
  //               if (!dbCommUsers[i].user.callSign) {
  //                 dbCommUsers[i].user.callSign=""
  //               }
  //               items[dbCommUsers[i]._id]={
  //                 value: dbCommUsers[i].user.username+' ('+dbCommUsers[i].user.callSign+')',
  //                 group: "#",
  //                 selected: true,
  //                 disabled: false,
  //                 description: dbCommUsers[i].user.dispatchStatus
  //               }
  //               break //if we found a match we want to break out
  //             } else {
  //               //To be deprecated once all users have set a call sign, going into effect 11/25/2020
  //               if (!dbCommUsers[i].user.callSign) {
  //                 dbCommUsers[i].user.callSign=""
  //               }
  //               items[dbCommUsers[i]._id]={
  //                 value: dbCommUsers[i].user.username+' ('+dbCommUsers[i].user.callSign+')',
  //                 group: "#",
  //                 selected: false,
  //                 disabled: false,
  //                 description: dbCommUsers[i].user.dispatchStatus
  //               }
  //             }
  //           }
  //         }
  //       }
  //       officerList.options.add(items)
  //     }
  //   }
  // }

  function hideModal(modalID) {
    $('#'+modalID).modal('hide')
  }

  function clearTextarea() {
    $('#notepad-textarea').val('')
  }

  $('#ticketModal').on('hidden.bs.modal', function () {
    $('#civID').popover('hide')
  })

  $('#warningModal').on('hidden.bs.modal', function () {
    $('#civIDWarning').popover('hide')
  })

  $('#createWarrantModal').on('hidden.bs.modal', function () {
    $('#civIDWarrant').popover('hide')
  })

  $('#clearWarrantModal').on('hidden.bs.modal', function () {
    $('#civIDWarning').popover('hide')
  })

  $('#plateDatabaseModal').on('hidden.bs.modal', function () {
    $(this).find('form').trigger('reset');
    $('#plateDetails').removeAttr("style").hide()
    $('#stolenMessage').removeAttr("style").hide()
  })

  function togglePanicBtnSound() {
    var socket=io();
    socket.emit('update_panic_btn_sound', dbUser)
    socket.on('load_panic_btn_result', (res) => {
      $('#panic-button-check-sound').prop("checked", !res.user.panicButtonSound)
      $('#successfully-updated-alert').removeClass('hide').addClass('show').delay(2000).fadeOut(1000, function () {
        $(this).addClass('hide').removeClass('show');
      });
    })
  }

  function adjustAlertVolumeSlider() {
    var socket=io();
    var volumeAmount = $('#alert-volume-slider').val()
    var myObj = {
      dbUser: dbUser,
      volume: volumeAmount
    }
    socket.emit('update_alert_volume_slider', myObj)
    socket.on('load_alert_volume_result', (res) => {
      $('#successfully-updated-alert').removeClass('hide').addClass('show').delay(2000).fadeOut(1000, function () {
        $(this).addClass('hide').removeClass('show');
      });
    })
  }

  function signal100() {
    //if it is already showing we don't want to show it again (there can only be 1 active
    // signal 100 per community)
    if (!$('#signal-100-banner').hasClass('show')) {
      
      var socket=io();
      myReq={
        userID: dbUser._id,
        userUsername: dbUser.user.username,
        activeCommunity: dbUser.user.activeCommunity
      }
      if ($('#panic-button-check-sound').prop('checked')) {
        var audioElement=document.createElement('audio');
        audioElement.setAttribute('src', '/static/audio/Dispatch_signal_100_beep_adj.mp3');
        audioElement.volume = dbUser.user.alertVolumeLevel/100 || 0.1;
        audioElement.play();
      }

      socket.emit('signal_100_button_update', myReq)
    }
  }

  function holdTraffic() {
    //if it is already showing we don't want to show it again (there can only be 1 active
    // hold traffic per community)
    if (!$('#hold-traffic-banner').hasClass('show')) {
      var socket=io();
      myReq={
        userID: dbUser._id,
        userUsername: dbUser.user.username,
        activeCommunity: dbUser.user.activeCommunity
      }
      if ($('#panic-button-check-sound').prop('checked')) {
        var audioElement=document.createElement('audio');
        audioElement.setAttribute('src', '/static/audio/Hold_traffic_sound_adj.mp3');
        audioElement.volume = dbUser.user.alertVolumeLevel/100 || 0.1;
        audioElement.play();
      }

      socket.emit('hold_traffic_button_update', myReq)
    }
  }

  function populateDriversLicense(civ) {
    if (civ != undefined && civ != null) {
      for (i=0; i<civ.length; i++) {
        var firstName=civ[i].civilian.firstName
        var lastName=civ[i].civilian.lastName
        var birthday=civ[i].civilian.birthday
        var createdDate=new Date(civ[i].civilian.createdAt)
        var expDay=createdDate.getDate()
        var expMonth=(createdDate.getMonth())+1
        var expYear=(createdDate.getFullYear())+10

        // since gender, height, weight, eyecolor, haircolor, donor and veteran is optional,
        // we will do a check to see if its undefined or empty and if so just set it to an
        // empty string (or false for booleans), otherwise set it to the value from the db.
        var gender=(civ[i].civilian.gender==undefined||civ[i].civilian.gender=='')? '':civ[i].civilian.gender.charAt(0); //we only want the first character ('M', 'F', 'N')
        // height needs to be converted to ft in or cm depending on the heightClassification
        if (civ[i].civilian.height==undefined||civ[i].civilian.height=='') {
          height=''
        } else {
          switch (civ[i].civilian.heightClassification) {
            case 'imperial':
              var feet=Math.floor(civ[i].civilian.height/12); // just dividing by 12 to get the feet
              var inches=("0"+civ[i].civilian.height%12).slice(-2); // mod by 12 to get remainder, but also pad with a '0' if less than '10'
              height=`${feet}'-${inches}"` // ex: 5'-07"
              break;
            case 'metric':
              height=`${civ[i].civilian.height} cm`
              break;
            default:
              height=civ[i].civilian.height
          }
        }
        // weight just needs the appropriate label based on the weightClassification (lb or kg)
        if (civ[i].civilian.weight==undefined||civ[i].civilian.weight=='') {
          weight=''
        } else {
          switch (civ[i].civilian.weightClassification) {
            case 'imperial':
              weight=`${civ[i].civilian.weight} lb`
              break;
            case 'metric':
              weight=`${civ[i].civilian.weight} kg`
              break;
            default:
              weight=civ[i].civilian.weight
          }
        }
        var eyeColor=(civ[i].civilian.eyeColor==undefined||civ[i].civilian.eyeColor=='')? '':civ[i].civilian.eyeColor.substring(0, 3); //only grab first 3 characters of string
        var hairColor=(civ[i].civilian.hairColor==undefined||civ[i].civilian.hairColor=='')? '':civ[i].civilian.hairColor.substring(0, 3); //only grab first 3 characters of string
        var donor=(civ[i].civilian.organDonor==undefined||civ[i].civilian.organDonor=='')? false:civ[i].civilian.organDonor;
        var veteran=(civ[i].civilian.veteran==undefined||civ[i].civilian.veteran=='')? false:civ[i].civilian.veteran;

        $('#civilianIDViewLic-'+i).text('DL: '+civ[i]._id)
        $('#firstNameLic-'+i).text(firstName)
        $('#lastNameLic-'+i).text(lastName)
        $('#addressViewLic-'+i).text(civ[i].civilian.address)
        $('#sexLic-'+i).text(gender);
        $('#heightLic-'+i).text(height);
        $('#weightLic-'+i).text(weight);
        $('#eyeLic-'+i).text(eyeColor);
        $('#hairLic-'+i).text(hairColor);
        if (donor===true) {
          $('.donor-block-'+i).removeClass('hide').addClass('show');
        }
        if (veteran===true) {
          $('.veteran-block-'+i).removeClass('hide').addClass('show');
        }
        switch (civ[i].civilian.licenseStatus) {
          case '1':
            $('#licenseStatusViewLic-'+i).text('Valid ').removeClass('color-red').addClass('color-black').append('<i class="ion-checkmark-circled color-green"></i>')
            $('#click-to-revoke-lic-'+i).removeClass('hide')
            $('#licenseRevokedMessage-'+i).addClass('hide')
            $('#noLicenseMessage-'+i).addClass('hide')
            break;
          case '2':
            $('#licenseStatusViewLic-'+i).text('Revoked ').removeClass('color-black').addClass('color-red').append('<i class="ion-alert-circled color-red"></i>')
            $('#click-to-revoke-lic-'+i).addClass('hide')
            $('#click-to-reinstate-lic-'+i).removeClass('hide')
            $('#licenseRevokedMessage-'+i).removeClass('hide')
            $('#noLicenseMessage-'+i).addClass('hide')
            break;
          default:
            $('#drivers-license-'+i).hide();
            $('#click-to-reinstate-lic-'+i).addClass('hide')
            $('#licenseStatusViewLic-'+i).text('None').removeClass('color-black').addClass('color-red')
            $('#licenseRevokedMessage-'+i).addClass('hide')
            $('#click-to-revoke-lic-'+i).addClass('hide')
            $('#drivers-license-details-'+i).addClass('hide')
            $('#noLicenseMessage-'+i).removeClass('hide')
        }
        var licenseDOB=birthday.split('-')
        if (licenseDOB != null && licenseDOB != undefined) {
          if (licenseDOB.length==3) {
            $('#birthdayViewLic-'+i).text(licenseDOB[1]+'/'+licenseDOB[2]+'/'+licenseDOB[0])
          } else {
            $('#birthdayViewLic-'+i).text(birthday)
          }
        }

        $('#license-expiration-'+i).text(expMonth.toString().padStart(2, '0')+'/'+expDay.toString().padStart(2, '0')+'/'+expYear) //Janky AF
        $('#license-issued-'+i).text(createdDate.toLocaleDateString('en-US', {
          day: "2-digit",
          month: "2-digit",
          year: "numeric"
        }))
      }
    }
  }

  function updateDriversLicenseStatus(i, civID, status) {
    var user={
      _id: civID,
      status: status
    }
    var socket=io();
    socket.emit('update_drivers_license_status', user)
    socket.on('load_updated_drivers_license_status_result', (res) => {
      switch (status) {
        case '1':
          $('#licenseStatusViewLic-'+i).text('Valid ').removeClass('color-red').addClass('color-black').append('<i class="ion-checkmark-circled color-green"></i>')
          $('#click-to-revoke-lic-'+i).removeClass('hide')
          $('#click-to-reinstate-lic-'+i).addClass('hide')
          $('#licenseRevokedMessage-'+i).addClass('hide')
          $('#noLicenseMessage-'+i).addClass('hide')
          break;
        case '2':
          $('#licenseStatusViewLic-'+i).text('Revoked ').removeClass('color-black').addClass('color-red').append('<i class="ion-alert-circled color-red"></i>')
          $('#click-to-revoke-lic-'+i).addClass('hide').removeClass('show')
          $('#click-to-reinstate-lic-'+i).removeClass('hide')
          $('#licenseRevokedMessage-'+i).removeClass('hide')
          $('#noLicenseMessage-'+i).addClass('hide')
          break;
        default:
          $('#drivers-license-'+i).hide();
          $('#click-to-reinstate-lic-'+i).addClass('hide')
          $('#licenseStatusViewLic-'+i).text('None').removeClass('color-black').addClass('color-red')
          $('#licenseRevokedMessage-'+i).addClass('hide')
          $('#click-to-revoke-lic-'+i).addClass('hide')
          $('#drivers-license-details-'+i).addClass('hide')
          $('#noLicenseMessage-'+i).removeClass('hide')
      }
    })
  }

  function loadCitations(civID) {
    $(`#ticket-body-${civID}`).empty(); //clears the table before loading results
    var data = {
      civID: civID
    }
    var socket=io();
    socket.emit('search_citation', data)
    socket.on('load_citation_result', (res) => {
      res.forEach(citation => {
      $(`#ticket-body-${civID}`).append(
        `<tr id="${citation._id}">
            <td>
              ${citation.ticket.date}
            </td>
            <td>
              ${citation.ticket.violation}
            </td>
            <td>
              $${citation.ticket.amount}
            </td>
            <td class="text-align-center">
              <a class='clickable' onclick="deleteCitation('${citation._id}', '${civID}')"><i class="glyphicon glyphicon-remove-circle color-alert-red"></i></a>
            </td>
        </tr>`
        ).fadeTo(1, function () {
            $(this).add();
          })
      });
    })
  }

  function loadWarnings(civID) {
    $(`#warning-body-${civID}`).empty();
    var data = {
      civID: civID
    }
    var socket=io();
    socket.emit('search_warnings', data)
    socket.on('load_warnings_result', (res) => {
      res.forEach(citation => {
      $(`#warning-body-${civID}`).append(
        `<tr id="${citation._id}">
            <td>
              ${citation.ticket.date}
            </td>
            <td>
              ${citation.ticket.violation}
            </td>
            <td class="text-align-center">
              <a class='clickable' onclick="deleteWarning('${citation._id}', '${civID}')"><i class="glyphicon glyphicon-remove-circle color-alert-red"></i></a>
            </td>
        </tr>`
        ).fadeTo(1, function () {
            $(this).add();
          })
      });
    })
  }

  // function loadArrests(civID) {
  //   $(`#arrest-body-${civID}`).empty();
  //   var data = {
  //     civID: civID
  //   }
  //   var socket=io();
  //   socket.emit('search_arrests', data)
  //   socket.on('load_arrests_result', (res) => {
  //     res.forEach(arrest => {
  //     $(`#arrest-body-${civID}`).append(
  //       `
  //         <tr id="${arrest._id}">
  //             <td>
  //               ${arrest.arrestReport.date}
  //             </td>
  //             <td>
  //               ${arrest.arrestReport.charges}
  //             </td>
  //             <td>
  //               ${arrest.arrestReport.summary}
  //             </td>
  //             <td class="text-align-center">
  //               <a class='clickable' onclick="deleteArrest('${arrest._id}', '${civID}')"><i class="glyphicon glyphicon-remove-circle color-alert-red"></i></a>
  //             </td>
  //         </tr>
  //       `
  //       ).fadeTo(1, function () {
  //           $(this).add();
  //         })
  //     });
  //   })
  // }


  function openNameDatabase(registeredOwner, activeCommunityID) {
    var activeCommID = ""
    if (activeCommunityID != null && activeCommunityID != undefined) {
      activeCommID = activeCommunityID
    }
    if (registeredOwner==null||registeredOwner==undefined) {
      if (activeCommID.length==0) {
        return document.location.href=`name-search?firstName=&lastName=&dateOfBirth=&route=dispatch-dashboard&activeCommunityID=${activeCommID}`
      }
      return document.location.href=`name-search?firstName=&lastName=&route=dispatch-dashboard&activeCommunityID=${activeCommID}`
    }
    let nameAndDOB=registeredOwner.split(" | ")
    if (nameAndDOB != null && nameAndDOB != undefined) {
      if (nameAndDOB.length!==2) {
        if (activeCommID.length==0) {
          return document.location.href=`name-search?firstName=&lastName=&dateOfBirth=&route=dispatch-dashboard&activeCommunityID=${activeCommID}`
        }
        return document.location.href=`name-search?firstName=&lastName=&route=dispatch-dashboard&activeCommunityID=${activeCommID}`
      }
    }
    let firstNameLastName=nameAndDOB[0].split(" ")
    if (firstNameLastName != null && firstNameLastName != undefined) {
      if (firstNameLastName.length!==2) {
        if (activeCommID.length==0) {
          return document.location.href=`name-search?firstName=&lastName=&dateOfBirth=&route=dispatch-dashboard&activeCommunityID=${activeCommID}`
        }
        return document.location.href=`name-search?firstName=&lastName=&route=dispatch-dashboard&activeCommunityID=${activeCommID}`
      }
    }
    //check to see if we are in a community, if we are not,
    //then we need to use the DOB to do the name search
    if (activeCommID.length==0) {
      let dob=nameAndDOB[1].split(" ")
      if (dob != null && dob != undefined) {
        if (dob.length!==2) {
          return document.location.href=`name-search?firstName=${firstNameLastName[0].trim()}&lastName=${firstNameLastName[1].trim()}&dateOfBirth=&route=dispatch-dashboard&activeCommunityID=${activeCommID}`
        }
      return document.location.href=`name-search?firstName=${firstNameLastName[0].trim()}&lastName=${firstNameLastName[1].trim()}&dateOfBirth=${dob[1]}&route=dispatch-dashboard&activeCommunityID=${activeCommID}`
      }
    }
    return document.location.href=`name-search?firstName=${firstNameLastName[0].trim()}&lastName=${firstNameLastName[1].trim()}&route=dispatch-dashboard&activeCommunityID=${activeCommID}`
  
  }

  function markAsRead() {
    document.cookie ="notification-symbol=v3.1.0";
    $('#notification-symbol').removeClass('notif');
    $('#notification-count').text('');
  }
</script>

<!--  added for google translate -->
<script type="text/javascript">
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en'}, 'google_translate_element');
}
</script>